<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard de Clubes</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.4/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
    <style>
        body { font-family: Arial, sans-serif; background: #f5f7f8; margin: 0; padding: 0; }
        h2 { text-align: center; margin: 20px 0; }
        .filtros { text-align: center; margin-bottom: 15px; }
        .kpi-container { display: flex; justify-content: space-around; flex-wrap: wrap; }
        .kpi { width: 180px; padding: 15px; border-radius: 10px; background: white; box-shadow: 0 0 5px #ccc; text-align: center; margin: 10px; transition: background-color 0.5s; }
        .kpi .valor { font-size: 22px; font-weight: bold; margin-top: 5px; }
        .kpi i { font-size: 28px; margin-bottom: 5px; }
        .charts { display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; padding: 0 20px; }
        .chart-box { background: white; border-radius: 10px; padding: 10px; box-shadow: 0 0 5px #ccc; }
        .tables { display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; padding: 20px; }
        table { width: 100%; border-collapse: collapse; font-size: 14px; }
        th, td { border-bottom: 1px solid #ddd; padding: 8px; text-align: left; }
        th { cursor: pointer; background: #f1f1f1; }
        .exportar { background: #28a745; color: white; padding: 6px 12px; border: none; border-radius: 5px; cursor: pointer; margin-left: 10px; }
        .exportar i { margin-right: 5px; }
        .updated { font-size: 12px; text-align: right; padding: 5px 20px; color: gray; }
    </style>
</head>
<body>

    <h2>Dashboard de Clubes</h2>
    <div class="filtros">
        Data: <input type="date" id="dataFiltro"> 
        Clube: <select id="clubeFiltro"></select>
        <button id="aplicar">Aplicar</button>
        <button class="exportar"><i class="fas fa-file-csv"></i>Exportar CSV</button>
    </div>

    <div class="kpi-container">
        <div class="kpi" id="kpi-ftd"><i class="fas fa-user-plus" style="color:green;"></i><div class="valor" data-valor="0">R$ 0,00</div>FTD</div>
        <div class="kpi" id="kpi-dep"><i class="fas fa-coins" style="color:gold;"></i><div class="valor" data-valor="0">R$ 0,00</div>Depósitos</div>
        <div class="kpi" id="kpi-ggr"><i class="fas fa-chart-line" style="color:blue;"></i><div class="valor" data-valor="0">R$ 0,00</div>GGR</div>
        <div class="kpi" id="kpi-sb"><i class="fas fa-football-ball" style="color:purple;"></i><div class="valor" data-valor="0">R$ 0,00</div>Sportsbook GGR</div>
        <div class="kpi" id="kpi-casino"><i class="fas fa-dice" style="color:red;"></i><div class="valor" data-valor="0">R$ 0,00</div>Cassino GGR</div>
        <div class="kpi" id="kpi-bonus"><i class="fas fa-gift" style="color:green;"></i><div class="valor" data-valor="0">R$ 0,00</div>Bônus Convertidos</div>
    </div>

    <div class="charts">
        <div class="chart-box"><canvas id="chartGGR"></canvas></div>
        <div class="chart-box"><canvas id="chartDepositos"></canvas></div>
        <div class="chart-box"><canvas id="chartFTD"></canvas></div>
        <div class="chart-box"><canvas id="chartSportsbook"></canvas></div>
        <div class="chart-box"><canvas id="chartCassino"></canvas></div>
        <div class="chart-box"><canvas id="chartBonus"></canvas></div>
    </div>

    <div class="tables">
        <div><table id="table-dep"><thead><tr><th>Clube</th><th>Valor</th></tr></thead><tbody></tbody></table></div>
        <div><table id="table-ftd"><thead><tr><th>Clube</th><th>Valor</th></tr></thead><tbody></tbody></table></div>
        <div><table id="table-ggr"><thead><tr><th>Clube</th><th>Valor</th></tr></thead><tbody></tbody></table></div>
        <div><table id="table-sb"><thead><tr><th>Clube</th><th>Valor</th></tr></thead><tbody></tbody></table></div>
        <div><table id="table-casino"><thead><tr><th>Clube</th><th>Valor</th></tr></thead><tbody></tbody></table></div>
        <div><table id="table-bonus"><thead><tr><th>Clube</th><th>Valor</th></tr></thead><tbody></tbody></table></div>
    </div>

    <div class="updated" id="updated"></div>

<script>
const urlCSV = "https://docs.google.com/spreadsheets/d/e/2PACX-1vQ21mvugq-_T80mCuddCnebiH30MWwJvQ58QiS9OqzHJuTXEVPsOFa9_Apzt4e9rlrLEeQtc8p60t80/pub?gid=0&single=true&output=csv";

let charts = {};
function criarGrafico(id, label, cor){
    return new Chart(document.getElementById(id), {
        type: 'line',
        data: { labels: [], datasets: [{ label: label, data: [], borderColor: cor, backgroundColor: cor, fill: false }] },
        options: { responsive: true, plugins: { tooltip: { enabled: true } } }
    });
}
charts.ggr = criarGrafico("chartGGR","Cálculo - GGR","green");
charts.dep = criarGrafico("chartDepositos","Usuário - Depósitos","blue");
charts.ftd = criarGrafico("chartFTD","Usuário - FTD-Montante","orange");
charts.sb = criarGrafico("chartSportsbook","Sportsbook - GGR","purple");
charts.casino = criarGrafico("chartCassino","Cassino - GGR","red");
charts.bonus = criarGrafico("chartBonus","Cálculo - bônus convertidos","teal");

function animarNumero(el, novo){
    let atual = parseFloat(el.dataset.valor)||0;
    let delta = (novo - atual)/20;
    let i=0;
    function step(){
        i++;
        let val = atual + delta*i;
        el.innerText = val.toLocaleString("pt-BR",{style:'currency',currency:'BRL'});
        if(i<20){ requestAnimationFrame(step); } else { el.dataset.valor = novo; }
    }
    step();
    if(novo > atual) el.parentElement.style.backgroundColor="#d4edda";
    else if(novo < atual) el.parentElement.style.backgroundColor="#f8d7da";
    setTimeout(()=>el.parentElement.style.backgroundColor="white",500);
}

function carregarDados(){
    Papa.parse(urlCSV, { download: true, header: true, complete: function(results){
        console.log("Primeiras linhas CSV:", results.data.slice(0,3));
        const dados = results.data.filter(r=>r["Usuário - Nome de usuário"]);
        // KPIs fake calc para demonstração
        let ftd=0, dep=0, ggr=0, sb=0, casino=0, bonus=0;
        dados.forEach(r=>{
            ftd+=parseFloat(r["Usuário - FTD-Montante"]||0);
            dep+=parseFloat(r["Usuário - Depósitos"]||0);
            ggr+=parseFloat(r["Cálculo - GGR"]||0);
            sb+=parseFloat(r["Sportsbook - GGR"]||0);
            casino+=parseFloat(r["Cassino - GGR"]||0);
            bonus+=parseFloat(r["Cálculo - bônus convertidos"]||0);
        });
        animarNumero(document.querySelector("#kpi-ftd .valor"), ftd);
        animarNumero(document.querySelector("#kpi-dep .valor"), dep);
        animarNumero(document.querySelector("#kpi-ggr .valor"), ggr);
        animarNumero(document.querySelector("#kpi-sb .valor"), sb);
        animarNumero(document.querySelector("#kpi-casino .valor"), casino);
        animarNumero(document.querySelector("#kpi-bonus .valor"), bonus);
        document.getElementById("updated").innerText = "Última atualização: "+new Date().toLocaleString();
    }});
}
$(document).ready(function(){
    carregarDados();
});
</script>
</body>
</html>
