<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Dashboard Comparativo de Clubes</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"/>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.4/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js"></script>
    <style>
        :root {
            --primary: #2c3e50;
            --secondary: #3498db;
            --accent: #e74c3c;
            --success: #2ecc71;
            --warning: #f39c12;
            --info: #9b59b6;
            --dark: #1a252f;
            --light: #ecf0f1;
            --gray: #95a5a6;
            --dark-gray: #34495e;
            --chart-blue: #3498db;
            --chart-red: #e74c3c;
            --chart-green: #2ecc71;
            --chart-purple: #9b59b6;
            --chart-orange: #f39c12;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #1a2a3a, #2c3e50);
            color: var(--light);
            min-height: 100vh;
            padding: 20px;
        }

        body.light-mode {
            background: #f4f7f9;
            color: #2c3e50;
        }
        body.light-mode .kpi, body.light-mode .controls, body.light-mode .chart-container, body.light-mode .table-container, body.light-mode .footer, body.light-mode header {
            background: #fff;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
            backdrop-filter: none;
            border: 1px solid #e0e6ed;
        }
        body.light-mode header h1 {
            background: linear-gradient(to right, var(--secondary), var(--info));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        body.light-mode h3, body.light-mode label, body.light-mode .valor {
            color: #2c3e50;
        }
        body.light-mode .btn-period, body.light-mode .btn-apply, body.light-mode .btn-export, body.light-mode .btn-mode {
            background: #e0e6ed;
            color: #2c3e50;
        }
        body.light-mode table th {
            background: #e0e6ed;
        }
        body.light-mode table tr:hover {
            background: #f7f9fa;
        }
        body.light-mode .variacao {
            color: #616e7c;
        }
        body.light-mode .positive, body.light-mode .negative {
            border-left: 5px solid;
        }
        body.light-mode .positive { border-left-color: #2ecc71; }
        body.light-mode .negative { border-left-color: #e74c3c; }
        body.light-mode input, body.light-mode select {
            background: #f7f9fa;
            border: 1px solid #e0e6ed;
            color: #2c3e50;
        }
        
        .container {
            max-width: 1800px;
            margin: 0 auto;
        }
        
        header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: rgba(26, 37, 47, 0.7);
            border-radius: 15px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        header h1 {
            font-size: 2.8rem;
            margin-bottom: 10px;
            background: linear-gradient(to right, var(--secondary), var(--success));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            display: inline-block;
        }
        
        header p {
            font-size: 1.2rem;
            color: var(--gray);
            max-width: 800px;
            margin: 0 auto;
        }
        
        .controls {
            background: rgba(26, 37, 47, 0.7);
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 30px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .control-section {
            margin-bottom: 25px;
        }
        
        .control-section h3 {
            margin-bottom: 15px;
            color: var(--secondary);
            font-size: 1.4rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .date-controls, .club-controls, .button-controls {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            align-items: center;
        }
        
        label {
            font-weight: 600;
            color: var(--light);
            min-width: 80px;
        }
        
        input, select {
            padding: 12px 15px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            background: rgba(0, 0, 0, 0.2);
            color: var(--light);
            border-radius: 8px;
            font-size: 1rem;
            transition: all 0.3s ease;
        }
        
        input:focus, select:focus {
            outline: none;
            border-color: var(--secondary);
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.3);
        }
        
        .btn-period, .btn-apply, .btn-export, .btn-mode {
            padding: 12px 20px;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 10px;
            transition: all 0.3s ease;
            font-size: 1rem;
        }
        
        .btn-period {
            background: rgba(52, 152, 219, 0.2);
            color: var(--secondary);
        }
        
        .btn-period:hover {
            background: rgba(52, 152, 219, 0.3);
        }
        
        .btn-apply {
            background: rgba(46, 204, 113, 0.2);
            color: var(--success);
        }
        
        .btn-apply:hover {
            background: rgba(46, 204, 113, 0.3);
        }
        
        .btn-export {
            background: rgba(155, 89, 182, 0.2);
            color: var(--info);
        }
        
        .btn-export:hover {
            background: rgba(155, 89, 182, 0.3);
        }
        
        .btn-mode {
            background: rgba(243, 156, 18, 0.2);
            color: var(--warning);
        }
        
        .btn-mode:hover {
            background: rgba(243, 156, 18, 0.3);
        }
        
        .kpi-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .kpi {
            background: rgba(26, 37, 47, 0.7);
            border-radius: 15px;
            padding: 25px;
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        
        .kpi:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 40px rgba(0, 0, 0, 0.4);
        }
        
        .kpi i {
            font-size: 2.5rem;
            margin-bottom: 15px;
        }
        
        .kpi h3 {
            font-size: 1.3rem;
            margin-bottom: 10px;
            color: var(--gray);
        }
        
        .kpi .valor {
            font-size: 1.8rem;
            font-weight: 700;
        }
        
        .kpi .variacao {
            font-size: 0.9rem;
            margin-top: 8px;
            font-weight: 600;
        }
        
        .positive {
            border-left: 5px solid var(--success);
        }
        
        .negative {
            border-left: 5px solid var(--accent);
        }
        
        .charts {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(600px, 1fr));
            gap: 25px;
            margin-bottom: 30px;
        }
        
        .chart-container {
            background: rgba(26, 37, 47, 0.7);
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .chart-container h3 {
            margin-bottom: 20px;
            font-size: 1.4rem;
            color: var(--secondary);
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .chart-container canvas {
            width: 100% !important;
            height: 300px !important;
        }
        
        .tables {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 25px;
            margin-bottom: 30px;
        }
        
        .table-container {
            background: rgba(26, 37, 47, 0.7);
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            overflow: hidden;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            table-layout: fixed;
        }
        
        th {
            background: rgba(52, 152, 219, 0.2);
            padding: 15px 10px;
            text-align: left;
            font-weight: 600;
            color: var(--secondary);
        }
        
        td {
            padding: 15px 10px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        table th:first-child, table td:first-child { width: 45%; }
        table th:nth-child(2), table td:nth-child(2) { width: 30%; }
        table th:nth-child(3), table td:nth-child(3) { width: 25%; }
        
        tr:last-child td {
            border-bottom: none;
        }
        
        tr:hover {
            background: rgba(255, 255, 255, 0.05);
        }
        
        .footer {
            text-align: center;
            padding: 25px;
            background: rgba(26, 37, 47, 0.7);
            border-radius: 15px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .footer p {
            margin-bottom: 10px;
            color: var(--gray);
        }
        
        #ultimaAtualizacao {
            font-weight: 600;
            color: var(--secondary);
        }
        
        #loadingOverlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            display: none;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            z-index: 9999;
        }
        
        .spinner {
            width: 80px;
            height: 80px;
            border: 8px solid rgba(52, 152, 219, 0.2);
            border-top: 8px solid var(--secondary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 20px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        #loadingMessage {
            font-size: 1.5rem;
            color: var(--light);
            font-weight: 600;
        }
        
        #demoWarning {
            background: rgba(243, 156, 18, 0.2);
            border: 1px solid var(--warning);
            border-radius: 8px;
            padding: 15px;
            margin: 20px 0;
            text-align: center;
            display: none;
        }
        
        @media (max-width: 1200px) {
            .charts {
                grid-template-columns: 1fr;
            }
            
            header h1 {
                font-size: 2.2rem;
            }
        }
        
        @media (max-width: 768px) {
            .kpi-container {
                grid-template-columns: 1fr;
            }
            
            .tables {
                grid-template-columns: 1fr;
            }
            
            .date-controls, .club-controls {
                flex-direction: column;
                align-items: stretch;
            }
            
            .btn-period, .btn-apply, .btn-export, .btn-mode {
                width: 100%;
                justify-content: center;
            }
            
            header h1 {
                font-size: 1.8rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1><i class="fas fa-chart-line"></i> Dashboard Comparativo de Clubes</h1>
            <p>Analise e compare o desempenho de diferentes clubes em tempo real</p>
        </header>

        <div id="demoWarning">
            <i class="fas fa-exclamation-triangle"></i> Você está visualizando dados de demonstração. Conecte-se à fonte de dados real para ver informações atualizadas.
        </div>

        <div class="controls">
            <div class="control-section">
                <h3><i class="fas fa-calendar-alt"></i> Período</h3>
                <div class="date-controls">
                    <label>De:</label>
                    <input type="date" id="filtroInicio"/>
                    <label>até</label>
                    <input type="date" id="filtroFim"/>
                    <button class="btn-period" onclick="setPeriodo(1)"><i class="fas fa-calendar-day"></i> Ontem</button>
                    <button class="btn-period" onclick="setPeriodo(7)"><i class="fas fa-calendar-week"></i> Últimos 7 dias</button>
                    <button class="btn-period" onclick="setPeriodo(30)"><i class="fas fa-calendar-alt"></i> Últimos 30 dias</button>
                </div>
            </div>
            
            <div class="control-section">
                <h3><i class="fas fa-users"></i> Clubes</h3>
                <div class="club-controls">
                    <label>Clube A:</label>
                    <select id="filtroClubeA"></select>
                    <label>Clube B:</label>
                    <select id="filtroClubeB"></select>
                    <button class="btn-apply" onclick="aplicarFiltros()">
                        <i class="fas fa-filter"></i> Aplicar Filtros
                    </button>
                </div>
            </div>
            
            <div class="control-section">
                <h3><i class="fas fa-cog"></i> Ações</h3>
                <div class="button-controls">
                    <div class="eliminar-clubes-suprema">
                        <input type="checkbox" id="eliminarSuprema" onchange="atualizar()">
                        <label for="eliminarSuprema">Eliminar Clubes Suprema</label>
                    </div>
                     <div class="eliminar-toni">
                        <input type="checkbox" id="eliminarToni" onchange="atualizar()">
                        <label for="eliminarToni">Eliminar TONI</label>
                    </div>
                    <button class="btn-export" onclick="exportarCSV()">
                        <i class="fas fa-file-csv"></i> Exportar CSV
                    </button>
                    <button class="btn-mode" onclick="toggleDarkMode()">
                        <i class="fas fa-moon"></i> Modo Escuro
                    </button>
                    <button class="btn-mode" onclick="atualizarDados()">
                        <i class="fas fa-sync"></i> Atualizar Dados
                    </button>
                </div>
            </div>
        </div>

        <div class="kpi-container">
            <div class="kpi positive" id="kpi-ftd">
                <i class="fa-solid fa-user-plus" style="color:#2ecc71"></i>
                <h3>FTD</h3>
                <div class="valor">R$ 0</div>
                <div class="variacao">+0.0%</div>
            </div>
            <div class="kpi positive" id="kpi-depositos">
                <i class="fa-solid fa-coins" style="color:#f39c12"></i>
                <h3>Depósitos</h3>
                <div class="valor">R$ 0</div>
                <div class="variacao">+0.0%</div>
            </div>
            <div class="kpi positive" id="kpi-ggr">
                <i class="fa-solid fa-chart-line" style="color:#3498db"></i>
                <h3>GGR</h3>
                <div class="valor">R$ 0</div>
                <div class="variacao">+0.0%</div>
            </div>
            <div class="kpi positive" id="kpi-sportsbook">
                <i class="fa-solid fa-futbol" style="color:#9b59b6"></i>
                <h3>Sportsbook GGR</h3>
                <div class="valor">R$ 0</div>
                <div class="variacao">+0.0%</div>
            </div>
            <div class="kpi positive" id="kpi-cassino">
                <i class="fa-solid fa-dice" style="color:#e74c3c"></i>
                <h3>Cassino GGR</h3>
                <div class="valor">R$ 0</div>
                <div class="variacao">+0.0%</div>
            </div>
            <div class="kpi positive" id="kpi-bonus">
                <i class="fa-solid fa-gift" style="color:#2ecc71"></i>
                <h3>Bônus Convertidos</h3>
                <div class="valor">R$ 0</div>
                <div class="variacao">+0.0%</div>
            </div>
        </div>

        <div class="charts">
            <div class="chart-container">
                <h3><i class="fas fa-chart-bar"></i> Visão Geral Comparativa</h3>
                <canvas id="chartComparativo"></canvas>
            </div>
            <div class="chart-container">
                <h3><i class="fas fa-chart-line"></i> Evolução do GGR</h3>
                <canvas id="chartGGR"></canvas>
            </div>
            <div class="chart-container">
                <h3><i class="fas fa-money-bill-wave"></i> Evolução de Depósitos</h3>
                <canvas id="chartDepositos"></canvas>
            </div>
            <div class="chart-container">
                <h3><i class="fas fa-user-plus"></i> Evolução do FTD</h3>
                <canvas id="chartFTD"></canvas>
            </div>
            <div class="chart-container">
                <h3><i class="fas fa-futbol"></i> Evolução do Sportsbook</h3>
                <canvas id="chartSportsbook"></canvas>
            </div>
            <div class="chart-container">
                <h3><i class="fas fa-dice"></i> Evolução do Cassino</h3>
                <canvas id="chartCassino"></canvas>
            </div>
        </div>

        <div class="tables">
            <div class="table-container">
                <h3><i class="fas fa-trophy"></i> Top 10 Depósitos</h3>
                <table id="topDepositos">
                    <thead>
                        <tr>
                            <th>Clube</th>
                            <th>Valor</th>
                            <th>Variação</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr><td colspan="3">Carregando...</td></tr>
                    </tbody>
                </table>
            </div>
            <div class="table-container">
                <h3><i class="fas fa-trophy"></i> Top 10 FTD</h3>
                <table id="topFTD">
                    <thead>
                        <tr>
                            <th>Clube</th>
                            <th>Valor</th>
                            <th>Variação</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr><td colspan="3">Carregando...</td></tr>
                    </tbody>
                </table>
            </div>
            <div class="table-container">
                <h3><i class="fas fa-trophy"></i> Top 10 GGR</h3>
                <table id="topGGR">
                    <thead>
                        <tr>
                            <th>Clube</th>
                            <th>Valor</th>
                            <th>Variação</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr><td colspan="3">Carregando...</td></tr>
                    </tbody>
                </table>
            </div>
            <div class="table-container">
                <h3><i class="fas fa-futbol"></i> Top 10 GGR Sportsbook</h3>
                <table id="topSportsbook">
                    <thead>
                        <tr>
                            <th>Clube</th>
                            <th>Valor</th>
                            <th>Variação</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr><td colspan="3">Carregando...</td></tr>
                    </tbody>
                </table>
            </div>
            <div class="table-container">
                <h3><i class="fas fa-dice"></i> Top 10 GGR Cassino</h3>
                <table id="topCassino">
                    <thead>
                        <tr>
                            <th>Clube</th>
                            <th>Valor</th>
                            <th>Variação</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr><td colspan="3">Carregando...</td></tr>
                    </tbody>
                </table>
            </div>
            <div class="table-container">
                <h3><i class="fas fa-gift"></i> Top 10 Bônus Convertidos</h3>
                <table id="topBonus">
                    <thead>
                        <tr>
                            <th>Clube</th>
                            <th>Valor</th>
                            <th>Variação</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr><td colspan="3">Carregando...</td></tr>
                    </tbody>
                </table>
            </div>
        </div>

        <div class="footer">
            <p>Última atualização: <span id="ultimaAtualizacao"></span></p>
            <p>Dashboard desenvolvido para análise comparativa de clubes | Dados atualizados automaticamente</p>
        </div>
    </div>

    <div id="loadingOverlay">
        <div class="spinner"></div>
        <div id="loadingMessage">Carregando dados...</div>
    </div>

    <script>
        const URL_CSV = "https://docs.google.com/spreadsheets/d/e/2PACX-1vQ21mvugq-_T80mCuddCnebiH30MWwJvQ58QiS9OqzHJuTXEVPsOFa9_Apzt4e9rlrLEeQtc8p60t80/pub?gid=0&single=true&output=csv";
        let dados = [], charts = {};
        
        const CLUBES_SUPREMA_LIST = [
            'romulo@xpgames.bet',
            'lucasfarinha@maximabet.net',
            'superodds@gmail.com',
            'clubedokw@gmail.com',
            'tropadogg@gmail.com',
            'galeradoinsta@gmail.com'
        ];
        
        const CLUBE_TONI = 'crisslots123@gmail.com';
        
        function showLoading(on, msg="Carregando dados..."){
            $("#loadingMessage").text(msg);
            $("#loadingOverlay").css("display", on ? "flex" : "none");
        }

        function criarGrafico(ctx, labelA, labelB, colorA, colorB, type='line'){
            return new Chart(ctx, {
                type: type,
                data: {
                    labels: [],
                    datasets: [
                        {
                            label: labelA,
                            data: [],
                            borderColor: colorA,
                            backgroundColor: type === 'bar' ? colorA + 'CC' : 'transparent',
                            fill: type === 'line',
                            tension: 0.3,
                            borderWidth: 3,
                            pointRadius: 4,
                            pointBackgroundColor: colorA
                        },
                        {
                            label: labelB,
                            data: [],
                            borderColor: colorB,
                            backgroundColor: type === 'bar' ? colorB + 'CC' : 'transparent',
                            fill: type === 'line',
                            tension: 0.3,
                            borderWidth: 3,
                            pointRadius: 4,
                            pointBackgroundColor: colorB
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { 
                            position: 'top', 
                            labels: { 
                                color: '#ecf0f1', 
                                font: { size: 14 },
                                filter: function(item, chart) {
                                    return item.text !== "";
                                } 
                            } 
                        },
                        tooltip: {
                            callbacks: {
                                label: ctx => {
                                    if(ctx.dataset.label === "" || (ctx.parsed.y === 0 && ctx.dataset.label === "Clube B")){
                                        return null;
                                    }
                                    return `${ctx.dataset.label}: R$ ${ctx.parsed.y.toLocaleString('pt-BR', {minimumFractionDigits: 2})}`;
                                }
                            },
                            backgroundColor: 'rgba(26, 37, 47, 0.9)',
                            titleColor: '#3498db',
                            bodyColor: '#ecf0f1',
                            displayColors: false,
                            padding: 12,
                            borderColor: 'rgba(255, 255, 255, 0.1)',
                            borderWidth: 1
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: v => `R$ ${v.toLocaleString('pt-BR', {minimumFractionDigits: 0})}`,
                                color: '#bdc3c7'
                            },
                            grid: { color: 'rgba(255, 255, 255, 0.05)' }
                        },
                        x: {
                            ticks: { color: '#bdc3c7' },
                            grid: { color: 'rgba(255, 255, 255, 0.05)' }
                        }
                    }
                }
            });
        }

        function animarKPI(sel, novo, anterior){
            let el = $(sel + " .valor");
            let varEl = $(sel + " .variacao");
            
            let variacao = 0;
            if (anterior !== undefined && anterior !== 0) {
                variacao = ((novo - anterior) / anterior) * 100;
            } else if (novo > 0 && anterior === 0) {
                variacao = 100;
            }
            
            let variacaoText = variacao >= 0 ? 
                `<span style="color: #2ecc71">+${variacao.toFixed(1)}%</span>` : 
                `<span style="color: #e74c3c">${variacao.toFixed(1)}%</span>`;
            varEl.html(variacaoText);
            
            $(sel).removeClass("positive negative")
                .addClass(novo >= anterior ? "positive" : "negative");
            
            let ant = parseFloat(el.text().replace(/[^\d]/g, '')) || 0;
            let diff = (novo - ant) / 30;
            let cur = ant;
            let pass = 0;
            
            let h = setInterval(() => {
                cur += diff;
                pass++;
                if (pass >= 30) {
                    clearInterval(h);
                    cur = novo;
                }
                el.text("R$ " + cur.toLocaleString('pt-BR', {minimumFractionDigits: 2}));
            }, 20);
        }

        function carregar(){
            showLoading(true, "Conectando à fonte de dados...");
            
            const urlComCacheBuster = URL_CSV + '&' + new Date().getTime();
            Papa.parse(urlComCacheBuster, {
                download: true,
                header: true,
                complete: function(r) {
                    if (r.data && r.data.length > 0) {
                        dados = r.data.filter(x => x.DATA);
                        // --- VERIFICAÇÃO DE DADOS ---
                        let somaVerificacao = dados.filter(d => 
                            new Date(d.DATA) >= new Date('2025-07-01') && new Date(d.DATA) <= new Date('2025-08-10')
                        ).reduce((s, d) => s + (parseFloat(d["Usuário - FTD-Montante"]) || 0), 0);
                        console.log(`Verificação: A soma total de FTD do período 01/07 a 10/08 é R$ ${somaVerificacao:,.2f}`);
                        // --- FIM DA VERIFICAÇÃO DE DADOS ---
                    } else {
                        console.error("Dados não encontrados na planilha do Google Sheets. Não é possível carregar o painel.");
                        dados = [];
                    }
                    init();
                },
                error: function() {
                    console.error("Erro ao carregar a planilha. Verifique a URL e a conexão.");
                    dados = [];
                    init();
                }
            });
        }

        function init(){
            let clubes = [...new Set(dados.map(d => d["Usuário - Nome de username"] || d["Usuário - Nome de usuário"]))];
            let opts = '<option value="Todos">Todos os Clubes</option>' +
                       clubes.map(c => `<option>${c}</option>`).join('');
            
            let optsClubeB = '<option value="Nenhum">Nenhum</option>' + opts;

            $("#filtroClubeA").html(opts).val("Todos");
            $("#filtroClubeB").html(optsClubeB).val("Nenhum");
            
            let hoje = new Date();
            let ontem = new Date();
            ontem.setDate(hoje.getDate() - 1);
            let anteontem = new Date();
            anteontem.setDate(hoje.getDate() - 2);
            $("#filtroInicio").val(anteontem.toISOString().slice(0,10));
            $("#filtroFim").val(ontem.toISOString().slice(0,10));
            
            charts.chartComparativo = criarGrafico($("#chartComparativo")[0], "Clube A", "Clube B", "#3498db", "#e74c3c", 'bar');
            charts.chartGGR = criarGrafico($("#chartGGR")[0], "Clube A GGR", "Clube B GGR", "#3498db", "#e74c3c");
            charts.chartDepositos = criarGrafico($("#chartDepositos")[0], "Clube A Depósitos", "Clube B Depósitos", "#3498db", "#e74c3c");
            charts.chartFTD = criarGrafico($("#chartFTD")[0], "Clube A FTD", "Clube B FTD", "#3498db", "#e74c3c");
            charts.chartSportsbook = criarGrafico($("#chartSportsbook")[0], "Clube A Sportsbook", "Clube B Sportsbook", "#3498db", "#e74c3c");
            charts.chartCassino = criarGrafico($("#chartCassino")[0], "Clube A Cassino", "Clube B Cassino", "#3498db", "#e74c3c");
            
            atualizar();
            showLoading(false);
            
            setInterval(atualizarDados, 300000);
        }

        function aplicarFiltros(){ atualizar(); }
        
        function setPeriodo(d){
            let hoje = new Date();
            let ontem = new Date();
            ontem.setDate(hoje.getDate() - 1);
            let ini = new Date();
            ini.setDate(ontem.getDate() - (d-1));
            $("#filtroInicio").val(ini.toISOString().slice(0,10));
            $("#filtroFim").val(ontem.toISOString().slice(0,10));
            atualizar();
        }
        
        function atualizarDados(){
            showLoading(true, "Atualizando dados...");
            carregar();
        }

        function atualizar(){
            let ini = $("#filtroInicio").val();
            let fim = $("#filtroFim").val();

            let dadosBase = [...dados];

            const eliminarSuprema = $("#eliminarSuprema").is(":checked");
            if (eliminarSuprema) {
                dadosBase = dadosBase.filter(d => 
                    !CLUBES_SUPREMA_LIST.includes(d["Usuário - Nome de usuário"] || d["Usuário - Nome de username"])
                );
            }
            
            const eliminarToni = $("#eliminarToni").is(":checked");
            if (eliminarToni) {
                 dadosBase = dadosBase.filter(d => 
                    (d["Usuário - Nome de usuário"] || d["Usuário - Nome de username"]) !== CLUBE_TONI
                );
            }
            
            let dadosFiltradosAtual = dadosBase.filter(d => d.DATA >= ini && d.DATA <= fim);
            
            let dadosPrimeiroDia = dadosBase.filter(d => d.DATA === ini);
            let dadosUltimoDia = dadosBase.filter(d => d.DATA === fim);
            
            let clubeA = $("#filtroClubeA").val();
            let clubeB = $("#filtroClubeB").val();
            
            let dadosClubeA_Atual = obterDadosDoClube(dadosFiltradosAtual, clubeA);
            let dadosClubeB_Atual = clubeB !== "Nenhum" && clubeA !== clubeB ? obterDadosDoClube(dadosFiltradosAtual, clubeB) : [];
            
            let dadosClubeA_PrimeiroDia = obterDadosDoClube(dadosPrimeiroDia, clubeA);
            let dadosClubeB_PrimeiroDia = clubeB !== "Nenhum" && clubeA !== clubeB ? obterDadosDoClube(dadosPrimeiroDia, clubeB) : [];

            let dadosClubeA_UltimoDia = obterDadosDoClube(dadosUltimoDia, clubeA);
            let dadosClubeB_UltimoDia = clubeB !== "Nenhum" && clubeA !== clubeB ? obterDadosDoClube(dadosUltimoDia, clubeB) : [];

            atualizarKPIs(dadosClubeA_UltimoDia, dadosClubeB_UltimoDia, dadosClubeA_PrimeiroDia, dadosClubeB_PrimeiroDia);
            atualizarGraficos(dadosClubeA_Atual, dadosClubeB_Atual, clubeA, clubeB);
            atualizarTabelas(dadosFiltradosAtual, dadosPrimeiroDia);
            
            $("#ultimaAtualizacao").text(new Date().toLocaleString('pt-BR'));
        }

        function obterDadosDoClube(dadosBase, nomeClube) {
            if (nomeClube === "Todos") {
                return dadosBase;
            }
            return dadosBase.filter(d => d["Usuário - Nome de username"] === nomeClube || d["Usuário - Nome de usuário"] === nomeClube);
        }
        
        function atualizarKPIs(dadosA_UltimoDia, dadosB_UltimoDia, dadosA_PrimeiroDia, dadosB_PrimeiroDia) {
            let somador = (arr, field) => arr.reduce((s, d) => s + (parseFloat(d[field]) || 0), 0);
            
            let totalFTD_UltimoDia = somador(dadosA_UltimoDia, "Usuário - FTD-Montante") + somador(dadosB_UltimoDia, "Usuário - FTD-Montante");
            let totalDepositos_UltimoDia = somador(dadosA_UltimoDia, "Usuário - Depósitos") + somador(dadosB_UltimoDia, "Usuário - Depósitos");
            let totalGGR_UltimoDia = somador(dadosA_UltimoDia, "Cálculo - GGR") + somador(dadosB_UltimoDia, "Cálculo - GGR");
            let totalSportsbook_UltimoDia = somador(dadosA_UltimoDia, "Sportsbook - GGR") + somador(dadosB_UltimoDia, "Sportsbook - GGR");
            let totalCassino_UltimoDia = somador(dadosA_UltimoDia, "Cassino - GGR") + somador(dadosB_UltimoDia, "Cassino - GGR");
            let totalBonus_UltimoDia = somador(dadosA_UltimoDia, "Cálculo - bônus convertidos") + somador(dadosB_UltimoDia, "Cálculo - bônus convertidos");

            let totalFTD_PrimeiroDia = somador(dadosA_PrimeiroDia, "Usuário - FTD-Montante") + somador(dadosB_PrimeiroDia, "Usuário - FTD-Montante");
            let totalDepositos_PrimeiroDia = somador(dadosA_PrimeiroDia, "Usuário - Depósitos") + somador(dadosB_PrimeiroDia, "Usuário - Depósitos");
            let totalGGR_PrimeiroDia = somador(dadosA_PrimeiroDia, "Cálculo - GGR") + somador(dadosB_PrimeiroDia, "Cálculo - GGR");
            let totalSportsbook_PrimeiroDia = somador(dadosA_PrimeiroDia, "Sportsbook - GGR") + somador(dadosB_PrimeiroDia, "Sportsbook - GGR");
            let totalCassino_PrimeiroDia = somador(dadosA_PrimeiroDia, "Cassino - GGR") + somador(dadosB_PrimeiroDia, "Cassino - GGR");
            let totalBonus_PrimeiroDia = somador(dadosA_PrimeiroDia, "Cálculo - bônus convertidos") + somador(dadosB_PrimeiroDia, "Cálculo - bônus convertidos");
            
            animarKPI("#kpi-ftd", totalFTD_UltimoDia, totalFTD_PrimeiroDia);
            animarKPI("#kpi-depositos", totalDepositos_UltimoDia, totalDepositos_PrimeiroDia);
            animarKPI("#kpi-ggr", totalGGR_UltimoDia, totalGGR_PrimeiroDia);
            animarKPI("#kpi-sportsbook", totalSportsbook_UltimoDia, totalSportsbook_PrimeiroDia);
            animarKPI("#kpi-cassino", totalCassino_UltimoDia, totalCassino_PrimeiroDia);
            animarKPI("#kpi-bonus", totalBonus_UltimoDia, totalBonus_PrimeiroDia);
        }

        function atualizarGraficos(dadosA, dadosB, nomeA, nomeB) {
            let agrupaPorData = arr => {
                let out = {};
                arr.forEach(d => {
                    out[d.DATA] = out[d.DATA] || { ggr: 0, dep: 0, ftd: 0, sb: 0, cs: 0, bo: 0 };
                    out[d.DATA].ggr += parseFloat(d["Cálculo - GGR"]) || 0;
                    out[d.DATA].dep += parseFloat(d["Usuário - Depósitos"]) || 0;
                    out[d.DATA].ftd += parseFloat(d["Usuário - FTD-Montante"]) || 0;
                    out[d.DATA].sb += parseFloat(d["Sportsbook - GGR"]) || 0;
                    out[d.DATA].cs += parseFloat(d["Cassino - GGR"]) || 0;
                    out[d.DATA].bo += parseFloat(d["Cálculo - bônus convertidos"]) || 0;
                });
                return out;
            };

            let dadosAgrupadosA = agrupaPorData(dadosA);
            let dadosAgrupadosB = dadosB.length > 0 ? agrupaPorData(dadosB) : {};
            let datas = [...new Set([...Object.keys(dadosAgrupadosA), ...Object.keys(dadosAgrupadosB)])].sort();

            const isClubeBSelecionado = nomeB !== "Nenhum";
            const corClubeB = isClubeBSelecionado ? "#e74c3c" : "rgba(0,0,0,0)";
            const labelClubeB = isClubeBSelecionado ? nomeB : "";

            function upd(chartId, campoDados){
                let chart = charts[chartId];
                chart.data.labels = datas;

                chart.data.datasets[0].label = nomeA;
                chart.data.datasets[0].data = datas.map(d => dadosAgrupadosA[d] ? dadosAgrupadosA[d][campoDados] : 0);
                
                chart.data.datasets[1].label = labelClubeB;
                chart.data.datasets[1].borderColor = corClubeB;
                chart.data.datasets[1].backgroundColor = isClubeBSelecionado ? chart.config.type === 'bar' ? corClubeB + 'CC' : 'transparent' : "rgba(0,0,0,0)";
                chart.data.datasets[1].pointBackgroundColor = corClubeB;
                chart.data.datasets[1].pointRadius = isClubeBSelecionado ? 4 : 0;
                chart.data.datasets[1].data = datas.map(d => dadosAgrupadosB[d] ? dadosAgrupadosB[d][campoDados] : 0);
                
                chart.update();
            }

            upd("chartGGR", "ggr");
            upd("chartDepositos", "dep");
            upd("chartFTD", "ftd");
            upd("chartSportsbook", "sb");
            upd("chartCassino", "cs");
            
            charts.chartComparativo.data.labels = ['FTD', 'Depósitos', 'GGR', 'Sportsbook', 'Cassino', 'Bônus'];
            charts.chartComparativo.data.datasets[0].label = nomeA;
            charts.chartComparativo.data.datasets[1].label = labelClubeB;
            charts.chartComparativo.data.datasets[1].backgroundColor = isClubeBSelecionado ? "#e74c3c" + 'CC' : 'rgba(0,0,0,0)';
            charts.chartComparativo.data.datasets[1].borderColor = corClubeB;

            let somador = (arr, field) => arr.reduce((s, d) => s + (parseFloat(d[field]) || 0), 0);
            
            charts.chartComparativo.data.datasets[0].data = [
                somador(dadosA, "Usuário - FTD-Montante"),
                somador(dadosA, "Usuário - Depósitos"),
                somador(dadosA, "Cálculo - GGR"),
                somador(dadosA, "Sportsbook - GGR"),
                somador(dadosA, "Cassino - GGR"),
                somador(dadosA, "Cálculo - bônus convertidos")
            ];

            charts.chartComparativo.data.datasets[1].data = isClubeBSelecionado ? [
                somador(dadosB, "Usuário - FTD-Montante"),
                somador(dadosB, "Usuário - Depósitos"),
                somador(dadosB, "Cálculo - GGR"),
                somador(dadosB, "Sportsbook - GGR"),
                somador(dadosB, "Cassino - GGR"),
                somador(dadosB, "Cálculo - bônus convertidos")
            ] : [0, 0, 0, 0, 0, 0];

            charts.chartComparativo.update();
        }

        function atualizarTabelas(dadosBase_Atual, dadosBase_PrimeiroDia) {
            let somadorPorClube = (arr, field) => arr.reduce((acc, d) => {
                let clube = d["Usuário - Nome de username"] || d["Usuário - Nome de usuário"];
                let valor = parseFloat(d[field]) || 0;
                acc[clube] = (acc[clube] || 0) + valor;
                return acc;
            }, {});

            function preenche(id, field) {
                let mapaValoresAtual = somadorPorClube(dadosBase_Atual, field);
                let mapaValoresPrimeiroDia = somadorPorClube(dadosBase_PrimeiroDia, field);
                
                let top10 = Object.entries(mapaValoresAtual).sort((a, b) => b[1] - a[1]).slice(0, 10);
                
                let html = top10.map(item => {
                    let clube = item[0];
                    let valorAtual = item[1];
                    let valorAnterior = mapaValoresPrimeiroDia[clube] || 0;
                    
                    let variacao = 0;
                    if (valorAnterior !== 0) {
                        variacao = ((valorAtual - valorAnterior) / valorAnterior) * 100;
                    } else if (valorAtual > 0) {
                        variacao = 100;
                    }

                    let corVariacao = variacao >= 0 ? '#2ecc70' : '#e74c3c';
                    return `<tr>
                        <td>${clube}</td>
                        <td>R$ ${valorAtual.toLocaleString('pt-BR', { minimumFractionDigits: 2 })}</td>
                        <td style="color:${corVariacao}">${variacao >= 0 ? '+' : ''}${variacao.toFixed(1)}%</td>
                    </tr>`;
                }).join('');

                $(id + " tbody").html(html);
            }
            
            preenche("#topDepositos", "Usuário - Depósitos");
            preenche("#topFTD", "Usuário - FTD-Montante");
            preenche("#topGGR", "Cálculo - GGR");
            preenche("#topSportsbook", "Sportsbook - GGR");
            preenche("#topCassino", "Cassino - GGR");
            preenche("#topBonus", "Cálculo - bônus convertidos");
        }
        
        function exportarCSV(){
            let csv = Papa.unparse(dados);
            let blob = new Blob(["\uFEFF" + csv], {type: "text/csv;charset=utf-8;"});
            let a = document.createElement("a");
            a.href = URL.createObjectURL(blob);
            a.download = "dados_clubes.csv";
            a.click();
        }
        
        function toggleDarkMode(){
            $('body').toggleClass('light-mode');
        }

        $(document).ready(function(){
            carregar();
            
            $('.kpi, .btn-period, .btn-apply, .btn-export, .btn-mode').hover(function(){
                $(this).css('transform', 'translateY(-3px)');
            }, function(){
                $(this).css('transform', 'none');
            });
        });
    </script>
</body>
</html>