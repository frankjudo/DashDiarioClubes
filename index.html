<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Dashboard Comparativo de Clubes</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.4/jquery.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js"></script>
  <style>
    body { font-family: Arial, sans-serif; background: #f5f7fa; margin: 0; padding: 0; overflow-y: auto; }
    h2 { text-align: center; margin: 20px 0; }
    .controls { text-align: center; margin-bottom: 15px; }
    .kpi-container { display: flex; justify-content: center; flex-wrap: wrap; gap: 15px; margin-bottom: 20px; }
    .kpi { background: #e8f5e9; border-radius: 8px; padding: 15px; width: 200px; text-align: center; box-shadow: 0 2px 5px rgba(0,0,0,0.1); transition: background 0.5s, transform 0.3s ease; }
    .kpi.negative { background: #ffebee !important; transform: scale(1.05); }
    .kpi i { font-size: 28px; margin-bottom: 8px; display: block; }
    .charts { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; padding: 0 20px; margin-bottom: 30px; }
    .chart-container { background: white; padding: 10px; border-radius: 8px; min-height: 300px; }
    .tables { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; padding: 20px; }
    table { width: 100%; border-collapse: collapse; font-size: 14px; background: white; border-radius: 8px; overflow: hidden; }
    th, td { padding: 6px; text-align: left; border-bottom: 1px solid #ddd; }
    th { background: #f0f0f0; font-weight: bold; }
    .footer { text-align: right; font-size: 12px; padding: 10px 20px; color: gray; }
    button { margin: 0 5px; padding: 6px 12px; border: none; border-radius: 4px; cursor: pointer; }
    .btn-export { background: #28a745; color: white; }
    .btn-apply { background: #007bff; color: white; }
  </style>
</head>
<body>
  <h2>Dashboard Comparativo de Clubes</h2>
  <div class="controls">
    De: <input type="date" id="filtroDataInicio">
    Até: <input type="date" id="filtroDataFim">
    <button onclick="setHoje()">Hoje</button>
    <button onclick="setUltimos(7)">Últimos 7 dias</button>
    <button onclick="setUltimos(30)">Últimos 30 dias</button>
    <br><br>
    Clube A: <select id="filtroClubeA"></select>
    Clube B: <select id="filtroClubeB"></select>
    <button class="btn-apply" onclick="aplicarFiltros()">Aplicar</button>
    <button class="btn-export" onclick="exportarCSV()"><i class="fa-solid fa-file-csv"></i> Exportar CSV</button>
  </div>

  <div class="kpi-container">
    <div class="kpi" id="kpi-ftd"><i class="fa-solid fa-user-plus" style="color:green"></i><span class="valor">0</span><br>FTD</div>
    <div class="kpi" id="kpi-depositos"><i class="fa-solid fa-coins" style="color:gold"></i><span class="valor">0</span><br>Depósitos</div>
    <div class="kpi" id="kpi-ggr"><i class="fa-solid fa-chart-line" style="color:blue"></i><span class="valor">0</span><br>GGR</div>
    <div class="kpi" id="kpi-sportsbook"><i class="fa-solid fa-football" style="color:purple"></i><span class="valor">0</span><br>Sportsbook GGR</div>
    <div class="kpi" id="kpi-cassino"><i class="fa-solid fa-dice" style="color:red"></i><span class="valor">0</span><br>Cassino GGR</div>
    <div class="kpi" id="kpi-bonus"><i class="fa-solid fa-gift" style="color:green"></i><span class="valor">0</span><br>Bônus Convertidos</div>
  </div>

  <div class="charts">
    <div class="chart-container"><canvas id="chartGGR"></canvas></div>
    <div class="chart-container"><canvas id="chartDepositos"></canvas></div>
    <div class="chart-container"><canvas id="chartFTD"></canvas></div>
    <div class="chart-container"><canvas id="chartSportsbook"></canvas></div>
    <div class="chart-container"><canvas id="chartCassino"></canvas></div>
    <div class="chart-container"><canvas id="chartBonus"></canvas></div>
  </div>

  <div class="tables">
    <div>
      <h4>Top 10 Depósitos</h4>
      <table id="topDepositos"><thead><tr><th>Clube</th><th>Valor</th></tr></thead><tbody></tbody></table>
    </div>
    <div>
      <h4>Top 10 FTD</h4>
      <table id="topFTD"><thead><tr><th>Clube</th><th>Valor</th></tr></thead><tbody></tbody></table>
    </div>
    <div>
      <h4>Top 10 GGR</h4>
      <table id="topGGR"><thead><tr><th>Clube</th><th>Valor</th></tr></thead><tbody></tbody></table>
    </div>
    <div>
      <h4>Top 10 Sportsbook</h4>
      <table id="topSportsbook"><thead><tr><th>Clube</th><th>Valor</th></tr></thead><tbody></tbody></table>
    </div>
    <div>
      <h4>Top 10 Cassino</h4>
      <table id="topCassino"><thead><tr><th>Clube</th><th>Valor</th></tr></thead><tbody></tbody></table>
    </div>
    <div>
      <h4>Top 10 Bônus Convertidos</h4>
      <table id="topBonus"><thead><tr><th>Clube</th><th>Valor</th></tr></thead><tbody></tbody></table>
    </div>
  </div>

  <div class="footer">Última atualização: <span id="ultimaAtualizacao"></span></div>

<script>
  const urlCSV = "https://docs.google.com/spreadsheets/d/e/2PACX-1vQ21mvugq-_T80mCuddCnebiH30MWwJvQ58QiS9OqzHJuTXEVPsOFa9_Apzt4e9rlrLEeQtc8p60t80/pub?gid=0&single=true&output=csv";
  let dadosFiltrados = [];

  const charts = {};
  function criarGrafico(ctx, labels) {
    return new Chart(ctx, {
      type: 'line',
      data: { labels, datasets: [{ label: "Clube A", data: [], borderColor: "blue", backgroundColor: "blue" }] },
      options: { responsive: true, plugins: { tooltip: { enabled: true } } }
    });
  }

  function animarKPI(id, valorNovo) {
    const el = $(id + " .valor");
    const valorAntigo = parseFloat(el.text().replace(/[R$\.,]/g,'')) || 0;
    const positivo = valorNovo >= 0;
    $(id).removeClass("negative").addClass(positivo ? "" : "negative");
    el.text("R$ " + valorNovo.toLocaleString('pt-BR', {minimumFractionDigits:2}));
  }

  function carregarDados() {
    Papa.parse(urlCSV, {
      download: true, header: true,
      complete: function(results) {
        dadosFiltrados = results.data;
        preencherFiltros();
        atualizarDashboard();
      }
    });
  }

  function preencherFiltros() {
    const clubes = [...new Set(dadosFiltrados.map(d => d["Usuário - Nome de usuário"]))];
    $("#filtroClubeA, #filtroClubeB").html('<option value="Todos">Todos</option>' + clubes.map(c => `<option value="${c}">${c}</option>`).join(''));
  }

  function aplicarFiltros() { atualizarDashboard(); }
  function setHoje() { let hoje = new Date().toISOString().split('T')[0]; $("#filtroDataInicio").val(hoje); $("#filtroDataFim").val(hoje); aplicarFiltros(); }
  function setUltimos(dias) { let hoje = new Date(); let inicio = new Date(); inicio.setDate(hoje.getDate() - dias); $("#filtroDataInicio").val(inicio.toISOString().split('T')[0]); $("#filtroDataFim").val(hoje.toISOString().split('T')[0]); aplicarFiltros(); }

  function atualizarDashboard() {
    $("#ultimaAtualizacao").text(new Date().toLocaleString());
    animarKPI("#kpi-ftd", 575588);
    animarKPI("#kpi-depositos", 10863128);
    animarKPI("#kpi-ggr", 2690690);
    animarKPI("#kpi-sportsbook", -441582);
    animarKPI("#kpi-cassino", 3132204);
    animarKPI("#kpi-bonus", 1119906);
  }

  function exportarCSV() {
    const csv = Papa.unparse(dadosFiltrados);
    const blob = new Blob([csv], { type: "text/csv;charset=utf-8;" });
    const link = document.createElement("a");
    link.href = URL.createObjectURL(blob);
    link.download = "dados_filtrados.csv";
    document.body.appendChild(link);
    link.click();
    document.body.removeChild(link);
  }

  $(document).ready(function(){
    charts.chartGGR = criarGrafico(document.getElementById('chartGGR'), []);
    charts.chartDepositos = criarGrafico(document.getElementById('chartDepositos'), []);
    charts.chartFTD = criarGrafico(document.getElementById('chartFTD'), []);
    charts.chartSportsbook = criarGrafico(document.getElementById('chartSportsbook'), []);
    charts.chartCassino = criarGrafico(document.getElementById('chartCassino'), []);
    charts.chartBonus = criarGrafico(document.getElementById('chartBonus'), []);
    carregarDados();
  });
</script>
</body>
</html>
