<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard Executivo - Clubes</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
    <style>
        body { font-family: 'Segoe UI', sans-serif; margin: 0; padding: 0; background: #f5f5f5; color: #333; }
        header { background: #fff; box-shadow: 0 2px 5px rgba(0,0,0,0.1); padding: 10px; text-align: center; }
        .filters { margin-top: 5px; }
        .cards { display: flex; justify-content: center; flex-wrap: wrap; gap: 10px; margin: 10px; }
        .card { background: #fff; padding: 10px; width: 170px; text-align: center; border-radius: 8px; 
                box-shadow: 0 2px 5px rgba(0,0,0,0.1); transition: transform 0.3s ease; }
        .card:hover { transform: translateY(-5px); }
        .card-icon { font-size: 20px; margin-bottom: 5px; }
        .charts { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; padding: 10px; }
        .chart-box { background: #fff; border-radius: 8px; padding: 5px; height: 180px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        .tables { display: grid; grid-template-columns: repeat(5, 1fr); gap: 10px; padding: 10px; }
        table { width: 100%; border-collapse: collapse; background: #fff; border-radius: 5px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); font-size: 13px; }
        th, td { border-bottom: 1px solid #ddd; text-align: left; padding: 4px 6px; }
        th { background: #f0f0f0; font-weight: 600; }
        footer { text-align: right; font-size: 12px; color: #666; margin: 10px; }
    </style>
</head>
<body>
    <header>
        <h2>Dashboard de Clubes</h2>
        <div class="filters">
            Data: <input type="date" id="dateFilter">
            Clube: <select id="clubeFilter"></select>
            <button onclick="applyFilters()">Aplicar</button>
        </div>
    </header>

    <div class="cards">
        <div class="card"><div class="card-icon">游녻</div><div>FTD</div><div id="ftdValue">R$ 0,00</div></div>
        <div class="card"><div class="card-icon">游눯</div><div>Dep칩sitos</div><div id="depositosValue">R$ 0,00</div></div>
        <div class="card"><div class="card-icon">游늵</div><div>GGR</div><div id="ggrValue">R$ 0,00</div></div>
        <div class="card"><div class="card-icon">游꿢</div><div>Sportsbook GGR</div><div id="sportsValue">R$ 0,00</div></div>
        <div class="card"><div class="card-icon">游꿣</div><div>Cassino GGR</div><div id="cassinoValue">R$ 0,00</div></div>
    </div>

    <div class="charts">
        <div class="chart-box"><canvas id="chartGGR"></canvas></div>
        <div class="chart-box"><canvas id="chartDepositos"></canvas></div>
        <div class="chart-box"><canvas id="chartFTD"></canvas></div>
        <div class="chart-box"><canvas id="chartSports"></canvas></div>
        <div class="chart-box"><canvas id="chartCassino"></canvas></div>
    </div>

    <div class="tables" id="tablesContainer"></div>

    <footer>칔ltima atualiza칞칚o: <span id="updateTime"></span></footer>

    <script>
        const SHEET_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vQ21mvugq-_T80mCuddCnebiH30MWwJvQ58QiS9OqzHJuTXEVPsOFa9_Apzt4e9rlrLEeQtc8p60t80/pub?gid=0&single=true&output=csv";

        let chartGGR, chartDepositos, chartFTD, chartSports, chartCassino;

        function formatCurrency(value) { return "R$ " + Number(value).toLocaleString('pt-BR', {minimumFractionDigits: 2}); }

        function createChart(ctx, label, color, labels, values) {
            return new Chart(ctx, {
                type: 'line',
                data: { labels: labels, datasets: [{ label: label, data: values, borderColor: color, fill: false, tension: 0.3 }] },
                options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { display: true } }, animation: { duration: 800 } }
            });
        }

        function generateTable(title, data) {
            let html = `<table><thead><tr><th>${title}</th><th>Valor</th></tr></thead><tbody>`;
            data.forEach(r => { html += `<tr><td>${r.clube}</td><td>${formatCurrency(r.valor)}</td></tr>`; });
            html += "</tbody></table>";
            return html;
        }

        function aggregateAndSort(data, key) {
            const map = {};
            data.forEach(row => {
                let clube = row["Usu치rio - Nome de usu치rio"];
                let valor = parseFloat(row[key] || 0);
                map[clube] = (map[clube] || 0) + valor;
            });
            return Object.entries(map).map(([clube, valor]) => ({ clube, valor }))
                        .sort((a,b) => b.valor - a.valor).slice(0,10);
        }

        function applyFilters() { loadData(); }

        function loadData() {
            Papa.parse(SHEET_URL, {
                download: true,
                header: true,
                complete: function(results) {
                    const data = results.data;

                    // Somas totais
                    const totalFTD = data.reduce((sum, row) => sum + parseFloat(row["Usu치rio - FTD-Montante"] || 0), 0);
                    const totalDep = data.reduce((sum, row) => sum + parseFloat(row["Usu치rio - Dep칩sitos"] || 0), 0);
                    const totalSports = data.reduce((sum, row) => sum + parseFloat(row["Sportsbook - GGR"] || 0), 0);
                    const totalCassino = data.reduce((sum, row) => sum + parseFloat(row["Cassino - GGR"] || 0), 0);
                    const totalGGR = data.reduce((sum, row) => sum + parseFloat(row["C치lculo - GGR"] || 0), 0);

                    // Atualiza cards
                    document.getElementById("ftdValue").textContent = formatCurrency(totalFTD);
                    document.getElementById("depositosValue").textContent = formatCurrency(totalDep);
                    document.getElementById("ggrValue").textContent = formatCurrency(totalGGR);
                    document.getElementById("sportsValue").textContent = formatCurrency(totalSports);
                    document.getElementById("cassinoValue").textContent = formatCurrency(totalCassino);

                    // Dados di치rios
                    const dates = [...new Set(data.map(row => row.DATA))].sort();
                    const getDaily = key => dates.map(d => data.filter(r=>r.DATA===d)
                                                    .reduce((s,r)=>s+parseFloat(r[key]||0),0));

                    const ggrValues = getDaily("C치lculo - GGR");
                    const depValues = getDaily("Usu치rio - Dep칩sitos");
                    const ftdValues = getDaily("Usu치rio - FTD-Montante");
                    const sportValues = getDaily("Sportsbook - GGR");
                    const cassinoValues = getDaily("Cassino - GGR");

                    // Cria gr치ficos
                    if(chartGGR) chartGGR.destroy();
                    if(chartDepositos) chartDepositos.destroy();
                    if(chartFTD) chartFTD.destroy();
                    if(chartSports) chartSports.destroy();
                    if(chartCassino) chartCassino.destroy();

                    chartGGR = createChart(document.getElementById('chartGGR'), "C치lculo - GGR", "green", dates, ggrValues);
                    chartDepositos = createChart(document.getElementById('chartDepositos'), "Usu치rio - Dep칩sitos", "blue", dates, depValues);
                    chartFTD = createChart(document.getElementById('chartFTD'), "Usu치rio - FTD-Montante", "gold", dates, ftdValues);
                    chartSports = createChart(document.getElementById('chartSports'), "Sportsbook - GGR", "orange", dates, sportValues);
                    chartCassino = createChart(document.getElementById('chartCassino'), "Cassino - GGR", "purple", dates, cassinoValues);

                    // Gera Top 10
                    const topDep = aggregateAndSort(data, "Usu치rio - Dep칩sitos");
                    const topFTD = aggregateAndSort(data, "Usu치rio - FTD-Montante");
                    const topGGR = aggregateAndSort(data, "C치lculo - GGR");
                    const topSports = aggregateAndSort(data, "Sportsbook - GGR");
                    const topCassino = aggregateAndSort(data, "Cassino - GGR");

                    document.getElementById("tablesContainer").innerHTML = 
                        generateTable("Top 10 Dep칩sitos", topDep) +
                        generateTable("Top 10 FTD", topFTD) +
                        generateTable("Top 10 GGR", topGGR) +
                        generateTable("Top 10 Sportsbook", topSports) +
                        generateTable("Top 10 Cassino", topCassino);

                    document.getElementById("updateTime").textContent = new Date().toLocaleString('pt-BR');
                }
            });
        }

        loadData();
    </script>
</body>
</html>
