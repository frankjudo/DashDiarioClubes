function detectColumns(headers) {
  const norm = s => (s || '').toString().normalize('NFD').replace(/\p{Diacritic}/gu,'').toLowerCase().trim();
  const exact = name => headers.find(h => norm(h) === norm(name)) || null;
  const find  = fn   => headers.find(h => fn(norm(h))) || null;

  const userNameExact =
    exact('Usuário - Nome de usuário') ||
    exact('Usuario - Nome de usuario') ||
    exact('Usuário – Nome de usuário');

  const ftdPrefer = exact('FTD-Montante') || exact('FTD Montante') || exact('Montante FTD');

  const ggrCalcHeader = find(n =>
    n.includes('ggr') && (n.includes('calculo') || n.includes('total')) &&
    !n.includes('sportsbook') && !n.includes('cassino')
  );

  const m = {
    date: find(n => n.includes('data')),
    club: userNameExact || find(n =>
      n.includes('usuario - nome de usuario') ||
      n.includes('nome de usuario') ||
      n.includes('usuario - nome') ||
      n.includes('clube') || n === 'user' || n.includes('usuario')
    ),
    email: userNameExact || find(n => n.includes('e-mail') || n.includes('email')),
    ftd:  ftdPrefer || find(n => (n.includes('ftd') && n.includes('montante'))) || find(n => n.includes('ftd')),
    
    // ✅ CORREÇÃO AQUI
    dep:  exact('Usuário - Depósitos') || find(n => n.includes('usuario - depositos') || n.includes('depositos') || n.includes('deposito')),

    ggrCalc: ggrCalcHeader,
    sb:   find(n => n.includes('sportsbook') && n.includes('ggr')),
    cs:   find(n => (n.includes('cassino') || n.includes('casino')) && n.includes('ggr')),
    hab:  find(n => n.includes('jogos de habilidade') || n.includes('habilidade') || n.includes('w/l') || n.includes('win/loss')),
    bonus:find(n => (n.includes('bonus') || n.includes('bonu')) && n.includes('convert'))
  };

  if (!m.date || !m.club || !m.ftd)
    throw new Error('Não encontrei colunas obrigatórias (DATA/CLUBE/FTD).');

  if (!m.email) m.email = m.club;
  return m;
}
