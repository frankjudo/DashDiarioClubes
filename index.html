<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard de Clubes</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            background: #000;
            color: #00ff00;
            margin: 0;
            padding: 0;
            text-align: center;
        }
        h1 { margin: 20px 0; }
        .filtros { margin-bottom: 20px; }
        .kpis {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: 15px;
            margin-bottom: 20px;
        }
        .kpi {
            background: #111;
            border: 2px solid #00ff00;
            box-shadow: 0 0 10px #00ff00;
            padding: 10px 20px;
            border-radius: 8px;
            min-width: 180px;
        }
        .kpi h2 { margin: 0; font-size: 20px; }
        .kpi p { font-size: 18px; }
        .graficos {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin: 0 5%;
        }
        .graficos canvas {
            background: #111;
            border: 2px solid #00ff00;
            box-shadow: 0 0 10px #00ff00;
            padding: 10px;
            border-radius: 8px;
        }
        .tabelas {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
            margin: 30px 5%;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            background: #111;
            box-shadow: 0 0 10px #00ff00;
            border: 2px solid #00ff00;
            color: #00ff00;
        }
        th, td {
            padding: 8px;
            border: 1px solid #00ff00;
            text-align: left;
        }
        th {
            background: #222;
            font-weight: bold;
        }
        footer { margin: 20px 0; font-size: 14px; }
    </style>
</head>
<body>

    <h1>Dashboard de Clubes</h1>
    <div class="filtros">
        Data: <input type="date" id="filtroData">
        Clube: <select id="filtroClube"></select>
        <button onclick="atualizarDashboard()">Aplicar</button>
    </div>

    <div class="kpis">
        <div class="kpi"><h2>FTD</h2><p id="kpiFTD">R$ 0,00</p></div>
        <div class="kpi"><h2>Depósitos</h2><p id="kpiDepositos">R$ 0,00</p></div>
        <div class="kpi"><h2>GGR</h2><p id="kpiGGR">R$ 0,00</p></div>
        <div class="kpi"><h2>Sportsbook GGR</h2><p id="kpiSportsGGR">R$ 0,00</p></div>
        <div class="kpi"><h2>Cassino GGR</h2><p id="kpiCassinoGGR">R$ 0,00</p></div>
    </div>

    <div class="graficos">
        <canvas id="graficoGGR"></canvas>
        <canvas id="graficoDepositos"></canvas>
        <canvas id="graficoFTD"></canvas>
        <canvas id="graficoSportsGGR"></canvas>
        <canvas id="graficoCassinoGGR"></canvas>
    </div>

    <div class="tabelas" id="tabelasTop10">
        <div>
            <h3>Top 10 Clubes - Depósitos</h3>
            <table id="tabelaDepositos"></table>
        </div>
        <div>
            <h3>Top 10 Clubes - FTD</h3>
            <table id="tabelaFTD"></table>
        </div>
        <div>
            <h3>Top 10 Clubes - GGR</h3>
            <table id="tabelaGGR"></table>
        </div>
        <div>
            <h3>Top 10 Clubes - Sportsbook GGR</h3>
            <table id="tabelaSportsGGR"></table>
        </div>
        <div>
            <h3>Top 10 Clubes - Cassino GGR</h3>
            <table id="tabelaCassinoGGR"></table>
        </div>
    </div>

    <footer id="ultimaAtualizacao"></footer>

    <script>
        const CSV_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vQ21mvugq-_T80mCuddCnebiH30MWwJvQ58QiS9OqzHJuTXEVPsOFa9_Apzt4e9rlrLEeQtc8p60t80/pub?gid=0&single=true&output=csv";

        let dados = [];
        let clubes = new Set();

        function carregarCSV() {
            console.log("Iniciando carregamento do CSV...");
            fetch(CSV_URL)
                .then(r => r.text())
                .then(text => processarCSV(text))
                .catch(err => console.error("Erro ao carregar CSV", err));
        }

        function processarCSV(text) {
            const linhas = text.split("\\n").map(l => l.split(","));
            const cabecalho = linhas.shift();
            console.log("Cabeçalho CSV:", cabecalho);

            dados = linhas.map(linha => {
                return {
                    data: linha[0],
                    clube: linha[3],
                    ftd: parseFloat(linha[5].replace(",", ".")) || 0,
                    depositos: parseFloat(linha[6].replace(",", ".")) || 0,
                    ggr: parseFloat(linha[21].replace(",", ".")) || 0,
                    sportsbook: parseFloat(linha[10].replace(",", ".")) || 0,
                    cassino: parseFloat(linha[13].replace(",", ".")) || 0
                };
            });

            dados.forEach(d => clubes.add(d.clube));
            preencherFiltroClubes();
            atualizarDashboard();
        }

        function preencherFiltroClubes() {
            const select = document.getElementById("filtroClube");
            select.innerHTML = '<option value="Todos">Todos</option>';
            clubes.forEach(c => select.innerHTML += `<option value="${c}">${c}</option>`);
        }

        function atualizarDashboard() {
            const dataFiltro = document.getElementById("filtroData").value;
            const clubeFiltro = document.getElementById("filtroClube").value;

            let filtrados = dados.filter(d => {
                let dataMatch = !dataFiltro || d.data.startsWith(dataFiltro);
                let clubeMatch = clubeFiltro === "Todos" || d.clube === clubeFiltro;
                return dataMatch && clubeMatch;
            });

            console.log("Filtro aplicado:", {data: dataFiltro, clube: clubeFiltro});
            console.log("Registros filtrados:", filtrados);

            const soma = (campo) => filtrados.reduce((acc, d) => acc + d[campo], 0);
            document.getElementById("kpiFTD").textContent = formatarMoeda(soma("ftd"));
            document.getElementById("kpiDepositos").textContent = formatarMoeda(soma("depositos"));
            document.getElementById("kpiGGR").textContent = formatarMoeda(soma("ggr"));
            document.getElementById("kpiSportsGGR").textContent = formatarMoeda(soma("sportsbook"));
            document.getElementById("kpiCassinoGGR").textContent = formatarMoeda(soma("cassino"));

            montarGraficos(filtrados);
            montarTabelas(filtrados);
            document.getElementById("ultimaAtualizacao").textContent = "Última atualização: " + new Date().toLocaleString();
        }

        function montarGraficos(filtrados) {
            // TODO: Implementar gráficos com Chart.js (similar ao anterior)
            console.log("Montando gráficos com dados filtrados...");
        }

        function montarTabelas(filtrados) {
            console.log("Montando tabelas com dados filtrados...");
            // TODO: Implementar tabelas Top 10 ordenadas por valor
        }

        function formatarMoeda(valor) {
            return valor.toLocaleString("pt-BR", {style: "currency", currency: "BRL"});
        }

        carregarCSV();
    </script>
</body>
</html>
