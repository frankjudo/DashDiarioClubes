<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard Executivo - Clubes</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js"></script>
    <style>
        body {
            font-family: 'Poppins', sans-serif;
            background: #f4f4f4;
            color: #333;
            margin: 0;
            padding: 0;
        }
        header {
            text-align: center;
            padding: 15px;
            background: #fff;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        header h1 {
            margin: 0;
            font-size: 1.8rem;
            color: #444;
        }
        .filters {
            text-align: center;
            margin: 15px 0;
        }
        .cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 20px;
            margin: 20px;
        }
        .card {
            background: #fff;
            border-radius: 8px;
            padding: 15px;
            box-shadow: 0 2px 6px rgba(0,0,0,0.1);
            text-align: center;
            transition: transform 0.3s ease-in-out;
        }
        .card:hover {
            transform: scale(1.05);
        }
        .card-icon {
            font-size: 2rem;
            margin-bottom: 5px;
        }
        .card-title {
            font-weight: 600;
            margin-bottom: 5px;
        }
        .card-value {
            font-size: 1.4rem;
            color: #111;
        }
        .charts {
            display: grid;
            grid-template-columns: 2fr 1fr;
            grid-template-rows: repeat(2, 300px);
            gap: 20px;
            margin: 20px;
        }
        .chart-box {
            background: #fff;
            border-radius: 8px;
            box-shadow: 0 2px 6px rgba(0,0,0,0.1);
            padding: 10px;
        }
        .tables {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
            gap: 20px;
            margin: 20px;
        }
        .table-box {
            background: #fff;
            border-radius: 8px;
            padding: 10px;
            box-shadow: 0 2px 6px rgba(0,0,0,0.1);
        }
        .table-box h3 {
            text-align: center;
            margin-bottom: 10px;
            font-size: 1rem;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.85rem;
        }
        table th, table td {
            padding: 6px;
            border-bottom: 1px solid #ddd;
            text-align: left;
        }
        .ranking-bar {
            height: 8px;
            background: #4CAF50;
            border-radius: 4px;
            margin-top: 4px;
        }
        footer {
            text-align: center;
            font-size: 0.8rem;
            margin: 20px;
            color: #666;
        }
    </style>
</head>
<body>

    <header>
        <h1>Dashboard de Clubes</h1>
        <div class="filters">
            Data: <input type="date" id="dateFilter">
            Clube: 
            <select id="clubFilter"><option value="Todos">Todos</option></select>
            <button onclick="applyFilters()">Aplicar</button>
        </div>
    </header>

    <div class="cards">
        <div class="card">
            <div class="card-icon">游녻</div>
            <div class="card-title">FTD</div>
            <div class="card-value" id="ftdValue">R$ 0,00</div>
        </div>
        <div class="card">
            <div class="card-icon">游눯</div>
            <div class="card-title">Dep칩sitos</div>
            <div class="card-value" id="depositValue">R$ 0,00</div>
        </div>
        <div class="card">
            <div class="card-icon">游늵</div>
            <div class="card-title">GGR</div>
            <div class="card-value" id="ggrValue">R$ 0,00</div>
        </div>
        <div class="card">
            <div class="card-icon">游꿢</div>
            <div class="card-title">Sportsbook GGR</div>
            <div class="card-value" id="sportsbookValue">R$ 0,00</div>
        </div>
        <div class="card">
            <div class="card-icon">游꿣</div>
            <div class="card-title">Cassino GGR</div>
            <div class="card-value" id="casinoValue">R$ 0,00</div>
        </div>
    </div>

    <div class="charts">
        <div class="chart-box"><canvas id="chartGGR"></canvas></div>
        <div class="chart-box"><canvas id="chartDeposits"></canvas></div>
        <div class="chart-box"><canvas id="chartFTD"></canvas></div>
        <div class="chart-box"><canvas id="chartSportsbook"></canvas></div>
        <div class="chart-box"><canvas id="chartCassino"></canvas></div>
    </div>

    <div class="tables">
        <div class="table-box"><h3>Top 10 Dep칩sitos</h3><table id="tableDeposits"></table></div>
        <div class="table-box"><h3>Top 10 FTD</h3><table id="tableFTD"></table></div>
        <div class="table-box"><h3>Top 10 GGR</h3><table id="tableGGR"></table></div>
        <div class="table-box"><h3>Top 10 Sportsbook</h3><table id="tableSportsbook"></table></div>
        <div class="table-box"><h3>Top 10 Cassino</h3><table id="tableCassino"></table></div>
    </div>

    <footer>
        칔ltima atualiza칞칚o: <span id="lastUpdate"></span>
    </footer>

<script>
const SHEET_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vQ21mvugq-_T80mCuddCnebiH30MWwJvQ58QiS9OqzHJuTXEVPsOFa9_Apzt4e9rlrLEeQtc8p60t80/pub?gid=0&single=true&output=csv";

let charts = {};

function formatCurrency(value) {
    return "R$ " + Number(value).toLocaleString("pt-BR", {minimumFractionDigits:2});
}

function initCharts() {
    charts.chartGGR = new Chart(document.getElementById('chartGGR'), { type: 'line', data: {labels: [], datasets: [{label: "C치lculo - GGR", borderColor: "green", fill: false, data: []}]}, options: {animation:{duration:800, easing:"easeOutQuart"}}});
    charts.chartDeposits = new Chart(document.getElementById('chartDeposits'), { type: 'line', data: {labels: [], datasets: [{label: "Usu치rio - Dep칩sitos", borderColor: "blue", fill: false, data: []}]}, options: {animation:{duration:800}}});
    charts.chartFTD = new Chart(document.getElementById('chartFTD'), { type: 'line', data: {labels: [], datasets: [{label: "Usu치rio - FTD-Montante", borderColor: "gold", fill: false, data: []}]}, options: {animation:{duration:800}}});
    charts.chartSportsbook = new Chart(document.getElementById('chartSportsbook'), { type: 'line', data: {labels: [], datasets: [{label: "Sportsbook - GGR", borderColor: "orange", fill: false, data: []}]}, options: {animation:{duration:800}}});
    charts.chartCassino = new Chart(document.getElementById('chartCassino'), { type: 'line', data: {labels: [], datasets: [{label: "Cassino - GGR", borderColor: "purple", fill: false, data: []}]}, options: {animation:{duration:800}}});
}

function loadData() {
    Papa.parse(SHEET_URL, {
        download: true,
        header: true,
        complete: function(results) {
            const data = results.data;
            document.getElementById("lastUpdate").innerText = new Date().toLocaleString("pt-BR");

            // valores totais
            document.getElementById("ftdValue").innerText = formatCurrency(sumColumn(data, "Usu치rio - FTD-Montante"));
            document.getElementById("depositValue").innerText = formatCurrency(sumColumn(data, "Usu치rio - Dep칩sitos"));
            document.getElementById("ggrValue").innerText = formatCurrency(sumColumn(data, "C치lculo - GGR"));
            document.getElementById("sportsbookValue").innerText = formatCurrency(sumColumn(data, "Sportsbook - GGR"));
            document.getElementById("casinoValue").innerText = formatCurrency(sumColumn(data, "Cassino - GGR"));

            updateCharts(data);
            updateTables(data);
        }
    });
}

function sumColumn(data, column) {
    return data.reduce((acc, row) => acc + (parseFloat(row[column]) || 0), 0);
}

function updateCharts(data) {
    const labels = [...new Set(data.map(row => row.DATA))].sort();
    charts.chartGGR.data.labels = labels;
    charts.chartGGR.data.datasets[0].data = labels.map(date => sumColumn(data.filter(r => r.DATA === date), "C치lculo - GGR"));
    charts.chartDeposits.data.labels = labels;
    charts.chartDeposits.data.datasets[0].data = labels.map(date => sumColumn(data.filter(r => r.DATA === date), "Usu치rio - Dep칩sitos"));
    charts.chartFTD.data.labels = labels;
    charts.chartFTD.data.datasets[0].data = labels.map(date => sumColumn(data.filter(r => r.DATA === date), "Usu치rio - FTD-Montante"));
    charts.chartSportsbook.data.labels = labels;
    charts.chartSportsbook.data.datasets[0].data = labels.map(date => sumColumn(data.filter(r => r.DATA === date), "Sportsbook - GGR"));
    charts.chartCassino.data.labels = labels;
    charts.chartCassino.data.datasets[0].data = labels.map(date => sumColumn(data.filter(r => r.DATA === date), "Cassino - GGR"));
    Object.values(charts).forEach(chart => chart.update());
}

function updateTables(data) {
    createRankingTable(data, "Usu치rio - Nome de usu치rio", "Usu치rio - Dep칩sitos", "tableDeposits");
    createRankingTable(data, "Usu치rio - Nome de usu치rio", "Usu치rio - FTD-Montante", "tableFTD");
    createRankingTable(data, "Usu치rio - Nome de usu치rio", "C치lculo - GGR", "tableGGR");
    createRankingTable(data, "Usu치rio - Nome de usu치rio", "Sportsbook - GGR", "tableSportsbook");
    createRankingTable(data, "Usu치rio - Nome de usu치rio", "Cassino - GGR", "tableCassino");
}

function createRankingTable(data, nameCol, valueCol, tableId) {
    let map = {};
    data.forEach(row => {
        const name = row[nameCol];
        const value = parseFloat(row[valueCol]) || 0;
        map[name] = (map[name] || 0) + value;
    });
    let ranking = Object.entries(map).sort((a, b) => b[1] - a[1]).slice(0, 10);
    let html = "<tr><th>Clube</th><th>Valor</th></tr>";
    ranking.forEach(([name, value]) => {
        html += `<tr><td>${name}<div class='ranking-bar' style='width:${(value/ranking[0][1])*100}%'></div></td><td>${formatCurrency(value)}</td></tr>`;
    });
    document.getElementById(tableId).innerHTML = html;
}

function applyFilters() {
    alert("Filtro de data e clube ser치 implementado com base nos par칙metros selecionados.");
}

initCharts();
loadData();
</script>
</body>
</html>
