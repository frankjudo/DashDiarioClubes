<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard de Clubes</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/papaparse@5.3.0/papaparse.min.js"></script>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background: #f4f4f4; margin: 0; padding: 0; }
        header { background: white; padding: 10px; text-align: center; font-size: 24px; font-weight: bold; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        .filters { text-align: center; margin: 10px 0; }
        .kpi-container { display: flex; justify-content: space-around; flex-wrap: wrap; margin: 20px; }
        .kpi { background: white; padding: 10px 20px; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); text-align: center; width: 160px; }
        .kpi h3 { margin: 0; font-size: 14px; color: #333; }
        .kpi p { font-size: 18px; font-weight: bold; margin: 5px 0 0 0; color: #000; }
        .charts { display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; margin: 20px; }
        .chart-box { background: white; padding: 10px; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); height: 180px; }
        .tables { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; margin: 20px; }
        table { width: 100%; border-collapse: collapse; background: white; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        th, td { padding: 5px; border-bottom: 1px solid #ddd; font-size: 12px; text-align: left; }
        th { background: #f0f0f0; }
        footer { text-align: center; font-size: 12px; margin: 20px 0; color: #666; }
    </style>
</head>
<body>
    <header>Dashboard de Clubes</header>
    <div class="filters">
        Data: <input type="date" id="dateFilter">
        Clube: <select id="clubeFilter"><option value="Todos">Todos</option></select>
        <button onclick="aplicarFiltro()">Aplicar</button>
    </div>

    <div class="kpi-container">
        <div class="kpi"><h3>FTD</h3><p id="kpi-ftd">R$ 0,00</p></div>
        <div class="kpi"><h3>Depósitos</h3><p id="kpi-depositos">R$ 0,00</p></div>
        <div class="kpi"><h3>GGR</h3><p id="kpi-ggr">R$ 0,00</p></div>
        <div class="kpi"><h3>Sportsbook GGR</h3><p id="kpi-sportsbook">R$ 0,00</p></div>
        <div class="kpi"><h3>Cassino GGR</h3><p id="kpi-cassino">R$ 0,00</p></div>
        <div class="kpi"><h3>Bônus Convertidos</h3><p id="kpi-bonus">R$ 0,00</p></div>
    </div>

    <div class="charts">
        <div class="chart-box"><canvas id="chartGGR"></canvas></div>
        <div class="chart-box"><canvas id="chartDepositos"></canvas></div>
        <div class="chart-box"><canvas id="chartFTD"></canvas></div>
        <div class="chart-box"><canvas id="chartSportsbook"></canvas></div>
        <div class="chart-box"><canvas id="chartCassino"></canvas></div>
        <div class="chart-box"><canvas id="chartBonus"></canvas></div>
    </div>

    <div class="tables">
        <table id="topDepositos"><thead><tr><th>Top 10 Depósitos</th><th>Valor</th></tr></thead><tbody></tbody></table>
        <table id="topFTD"><thead><tr><th>Top 10 FTD</th><th>Valor</th></tr></thead><tbody></tbody></table>
        <table id="topGGR"><thead><tr><th>Top 10 GGR</th><th>Valor</th></tr></thead><tbody></tbody></table>
        <table id="topSportsbook"><thead><tr><th>Top 10 Sportsbook</th><th>Valor</th></tr></thead><tbody></tbody></table>
        <table id="topCassino"><thead><tr><th>Top 10 Cassino</th><th>Valor</th></tr></thead><tbody></tbody></table>
        <table id="topBonus"><thead><tr><th>Top 10 Bônus</th><th>Valor</th></tr></thead><tbody></tbody></table>
    </div>

    <footer>Última atualização: <span id="lastUpdate"></span></footer>

    <script>
        const SHEET_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vQ21mvugq-_T80mCuddCnebiH30MWwJvQ58QiS9OqzHJuTXEVPsOFa9_Apzt4e9rlrLEeQtc8p60t80/pub?gid=0&single=true&output=csv";
        let allData = [];

        function aplicarFiltro() {
            const date = document.getElementById('dateFilter').value;
            const clube = document.getElementById('clubeFilter').value;
            console.log("Filtro aplicado", {date, clube});
            processarDados(date, clube);
        }

        function processarDados(dateFilter, clubeFilter) {
            let data = allData;
            if (dateFilter) data = data.filter(row => row["DATA"] === dateFilter);
            if (clubeFilter !== "Todos") data = data.filter(row => row["Usuário - Nome de usuário"] === clubeFilter);

            console.log("Dados filtrados", data);
            // aqui entram as funções para recalcular KPIs, gráficos e tabelas...
        }

        Papa.parse(SHEET_URL, {
            download: true,
            header: true,
            complete: function(results) {
                allData = results.data;
                console.log("Dados carregados:", allData.length);
                atualizarClubes();
                processarDados(null, "Todos");
            }
        });

        function atualizarClubes() {
            const clubes = [...new Set(allData.map(d => d["Usuário - Nome de usuário"]).filter(Boolean))];
            const select = document.getElementById("clubeFilter");
            clubes.forEach(c => {
                const opt = document.createElement("option");
                opt.value = c; opt.textContent = c;
                select.appendChild(opt);
            });
        }
    </script>
</body>
</html>
