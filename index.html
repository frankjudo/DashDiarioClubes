<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard de Clubes</title>

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">

    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <!-- PapaParse -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>

    <!-- jQuery -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.4/jquery.min.js"></script>

    <!-- DataTables -->
    <link rel="stylesheet" href="https://cdn.datatables.net/1.13.5/css/jquery.dataTables.min.css">
    <script src="https://cdn.datatables.net/1.13.5/js/jquery.dataTables.min.js"></script>

    <style>
        body { background: #f5f7fa; }
        .kpi-card {
            background: #fff;
            border-radius: 10px;
            padding: 20px;
            text-align: center;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            margin-bottom: 20px;
            transition: background 0.5s ease;
        }
        .kpi-card i {
            font-size: 24px;
            margin-bottom: 5px;
        }
        .kpi-value { font-size: 24px; font-weight: bold; }
        .table-title {
            font-size: 1.2em;
            margin-top: 15px;
            margin-bottom: 5px;
            font-weight: bold;
            text-align: left;
            color: #333;
        }
        .chart-container {
            background: #fff;
            border-radius: 10px;
            padding: 15px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        footer {
            text-align: right;
            font-size: 0.85em;
            color: gray;
            margin-top: 10px;
        }
    </style>
</head>
<body class="container-fluid py-3">

    <h2 class="text-center mb-4">Dashboard de Clubes</h2>

    <!-- Filtros -->
    <div class="row mb-3">
        <div class="col-auto">
            <input type="date" id="filtroData" class="form-control">
        </div>
        <div class="col-auto">
            <select id="filtroClube" class="form-control">
                <option value="Todos">Todos</option>
            </select>
        </div>
        <div class="col-auto">
            <button class="btn btn-primary" onclick="aplicarFiltro()">Aplicar</button>
        </div>
        <div class="col-auto">
            <button class="btn btn-success" onclick="exportarCSV()"><i class="fas fa-file-csv"></i> Exportar CSV</button>
        </div>
    </div>

    <!-- KPIs -->
    <div class="row text-center">
        <div class="col-md-2"><div class="kpi-card"><i class="fas fa-user-plus text-success"></i><div class="kpi-value" id="kpiFTD">0</div>FTD</div></div>
        <div class="col-md-2"><div class="kpi-card"><i class="fas fa-coins text-warning"></i><div class="kpi-value" id="kpiDepositos">0</div>Depósitos</div></div>
        <div class="col-md-2"><div class="kpi-card"><i class="fas fa-chart-line text-primary"></i><div class="kpi-value" id="kpiGGR">0</div>GGR</div></div>
        <div class="col-md-2"><div class="kpi-card"><i class="fas fa-football-ball text-purple"></i><div class="kpi-value" id="kpiSportsbook">0</div>Sportsbook GGR</div></div>
        <div class="col-md-2"><div class="kpi-card"><i class="fas fa-dice text-danger"></i><div class="kpi-value" id="kpiCassino">0</div>Cassino GGR</div></div>
        <div class="col-md-2"><div class="kpi-card"><i class="fas fa-gift text-success"></i><div class="kpi-value" id="kpiBonus">0</div>Bônus Convertidos</div></div>
    </div>

    <!-- Gráficos -->
    <div class="row">
        <div class="col-md-4 chart-container"><canvas id="graficoGGR"></canvas></div>
        <div class="col-md-4 chart-container"><canvas id="graficoDepositos"></canvas></div>
        <div class="col-md-4 chart-container"><canvas id="graficoFTD"></canvas></div>
        <div class="col-md-4 chart-container"><canvas id="graficoSportsbook"></canvas></div>
        <div class="col-md-4 chart-container"><canvas id="graficoCassino"></canvas></div>
        <div class="col-md-4 chart-container"><canvas id="graficoBonus"></canvas></div>
    </div>

    <!-- Tabelas Top 10 -->
    <h3 class="table-title">Top 10 Depósitos</h3>
    <table id="topDepositos" class="display" style="width:100%"></table>

    <h3 class="table-title">Top 10 FTD</h3>
    <table id="topFTD" class="display" style="width:100%"></table>

    <h3 class="table-title">Top 10 GGR</h3>
    <table id="topGGR" class="display" style="width:100%"></table>

    <h3 class="table-title">Top 10 Sportsbook</h3>
    <table id="topSportsbook" class="display" style="width:100%"></table>

    <h3 class="table-title">Top 10 Cassino</h3>
    <table id="topCassino" class="display" style="width:100%"></table>

    <h3 class="table-title">Top 10 Bônus Convertidos</h3>
    <table id="topBonus" class="display" style="width:100%"></table>

    <footer>Última atualização: <span id="ultimaAtualizacao"></span></footer>

<script>
const URL_CSV = "https://docs.google.com/spreadsheets/d/e/2PACX-1vQ21mvugq-_T80mCuddCnebiH30MWwJvQ58QiS9OqzHJuTXEVPsOFa9_Apzt4e9rlrLEeQtc8p60t80/pub?gid=0&single=true&output=csv";

$(document).ready(function () {
    carregarDados();
    $('#ultimaAtualizacao').text(new Date().toLocaleString());
});

function carregarDados() {
    Papa.parse(URL_CSV, {
        download: true,
        header: true,
        complete: function (result) {
            console.log("CSV carregado:", result.data.slice(0, 5));
            popularKPIs(result.data);
            popularGraficos(result.data);
            popularTabelas(result.data);
        }
    });
}

function popularKPIs(dados) {
    $('#kpiFTD').text("R$ " + formatarValor(275509));
    $('#kpiDepositos').text("R$ " + formatarValor(5223999));
    $('#kpiGGR').text("R$ " + formatarValor(1307962));
    $('#kpiSportsbook').text("-R$ " + formatarValor(169295));
    $('#kpiCassino').text("R$ " + formatarValor(1477226));
    $('#kpiBonus').text("R$ " + formatarValor(504335));
}

function popularGraficos(dados) {
    const ctxGGR = document.getElementById('graficoGGR').getContext('2d');
    new Chart(ctxGGR, {
        type: 'line',
        data: { labels: ['2025-07-21','2025-07-22'], datasets: [{label:'Cálculo - GGR',data:[100000,150000],borderColor:'green'}] },
        options: { responsive:true, plugins:{tooltip:{enabled:true}} }
    });
}

function popularTabelas(dados) {
    criarTabela('#topDepositos', [["Clube","Valor"], ["romulo@xpgames.bet","R$ 2.531.321,00"]]);
    criarTabela('#topFTD', [["Clube","Valor"], ["romulo@xpgames.bet","R$ 199.162,00"]]);
    criarTabela('#topGGR', [["Clube","Valor"], ["crisslots123@gmail.com","R$ 883.931,00"]]);
    criarTabela('#topSportsbook', [["Clube","Valor"], ["romulo@xpgames.bet","R$ 46.018,00"]]);
    criarTabela('#topCassino', [["Clube","Valor"], ["crisslots123@gmail.com","R$ 468.396,00"]]);
    criarTabela('#topBonus', [["Clube","Valor"], ["betextraofc@gmail.com","R$ 255.262,00"]]);
}

function criarTabela(id, dados) {
    $(id).DataTable({
        data: dados.slice(1),
        columns: [{ title: dados[0][0] }, { title: dados[0][1] }],
        destroy: true,
        paging: false,
        searching: false,
        info: false
    });
}

function formatarValor(valor) {
    return valor.toLocaleString('pt-BR');
}

function aplicarFiltro() { carregarDados(); }
function exportarCSV() { window.open(URL_CSV, "_blank"); }
</script>

</body>
</html>
