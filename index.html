<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard de Clubes</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <style>
        body { background: #f8f9fa; }
        .kpi-card { transition: all 0.3s ease; text-align:center; padding: 20px; margin:10px; border-radius: 10px; background:#fff; box-shadow: 0 4px 10px rgba(0,0,0,0.1); }
        .kpi-value { font-size: 1.5em; font-weight: bold; }
        .chart-container { height: 200px !important; }
    </style>
</head>
<body class="container-fluid">

<h3 class="text-center my-3">Dashboard de Clubes</h3>

<div class="row mb-3">
    <div class="col-md-4">
        Data: <input type="date" id="filtroData">
        Clube: 
        <select id="filtroClube"><option value="Todos">Todos</option></select>
        <button id="btnAplicar" class="btn btn-sm btn-primary">Aplicar</button>
        <button id="btnExportar" class="btn btn-sm btn-success">Exportar CSV</button>
    </div>
</div>

<div class="row text-center">
    <div class="col kpi-card"><i class="fa-solid fa-user-plus fa-2x text-success"></i><div class="kpi-value" id="kpiFTD">R$ 0,00</div><div>FTD</div></div>
    <div class="col kpi-card"><i class="fa-solid fa-coins fa-2x text-warning"></i><div class="kpi-value" id="kpiDepositos">R$ 0,00</div><div>Depósitos</div></div>
    <div class="col kpi-card"><i class="fa-solid fa-chart-line fa-2x text-primary"></i><div class="kpi-value" id="kpiGGR">R$ 0,00</div><div>GGR</div></div>
    <div class="col kpi-card"><i class="fa-solid fa-football fa-2x text-dark"></i><div class="kpi-value" id="kpiSports">R$ 0,00</div><div>Sportsbook GGR</div></div>
    <div class="col kpi-card"><i class="fa-solid fa-dice fa-2x text-danger"></i><div class="kpi-value" id="kpiCassino">R$ 0,00</div><div>Cassino GGR</div></div>
    <div class="col kpi-card"><i class="fa-solid fa-gift fa-2x text-success"></i><div class="kpi-value" id="kpiBonus">R$ 0,00</div><div>Bônus Convertidos</div></div>
</div>

<div class="row my-3">
    <div class="col-md-4"><canvas id="chartGGR" class="chart-container"></canvas></div>
    <div class="col-md-4"><canvas id="chartDepositos" class="chart-container"></canvas></div>
    <div class="col-md-4"><canvas id="chartFTD" class="chart-container"></canvas></div>
</div>
<div class="row my-3">
    <div class="col-md-4"><canvas id="chartSports" class="chart-container"></canvas></div>
    <div class="col-md-4"><canvas id="chartCassino" class="chart-container"></canvas></div>
    <div class="col-md-4"><canvas id="chartBonus" class="chart-container"></canvas></div>
</div>

<p class="text-end text-muted"><small>Última atualização: <span id="ultimaAtualizacao"></span></small></p>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.4/jquery.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>

<script>
$(document).ready(function () {
    carregarDados();
});

function carregarDados() {
    const urlCSV = "https://docs.google.com/spreadsheets/d/e/2PACX-1vQ21mvugq-_T80mCuddCnebiH30MWwJvQ58QiS9OqzHJuTXEVPsOFa9_Apzt4e9rlrLEeQtc8p60t80/pub?gid=0&single=true&output=csv";
    Papa.parse(urlCSV, {
        download: true,
        header: true,
        complete: function(results) {
            console.log("Primeiras linhas do CSV carregado:", results.data.slice(0,5));
            $('#ultimaAtualizacao').text(new Date().toLocaleString());
            processarDados(results.data);
        }
    });
}

function processarDados(data) {
    let datas = {};
    data.forEach(row => {
        let d = row["DATA"];
        if (!datas[d]) {
            datas[d] = {ggr:0, depositos:0, ftd:0, sports:0, cassino:0, bonus:0};
        }
        datas[d].ggr += parseFloat(row["Cálculo - GGR"] || 0);
        datas[d].depositos += parseFloat(row["Usuário - Depósitos"] || 0);
        datas[d].ftd += parseFloat(row["Usuário - FTD-Montante"] || 0);
        datas[d].sports += parseFloat(row["Sportsbook - GGR"] || 0);
        datas[d].cassino += parseFloat(row["Cassino - GGR"] || 0);
        datas[d].bonus += parseFloat(row["Cálculo - bônus convertidos"] || 0);
    });

    let labels = Object.keys(datas).sort();
    let ggr = labels.map(d => datas[d].ggr);
    let dep = labels.map(d => datas[d].depositos);
    let ftd = labels.map(d => datas[d].ftd);
    let sports = labels.map(d => datas[d].sports);
    let cassino = labels.map(d => datas[d].cassino);
    let bonus = labels.map(d => datas[d].bonus);

    criarGrafico("chartGGR","Cálculo - GGR",labels,ggr,'green');
    criarGrafico("chartDepositos","Usuário - Depósitos",labels,dep,'blue');
    criarGrafico("chartFTD","Usuário - FTD-Montante",labels,ftd,'orange');
    criarGrafico("chartSports","Sportsbook - GGR",labels,sports,'purple');
    criarGrafico("chartCassino","Cassino - GGR",labels,cassino,'red');
    criarGrafico("chartBonus","Cálculo - bônus convertidos",labels,bonus,'teal');
}

function criarGrafico(id,label,labels,data,color) {
    new Chart(document.getElementById(id), {
        type: 'line',
        data: {
            labels: labels,
            datasets: [{
                label: label,
                data: data,
                borderColor: color,
                backgroundColor: color,
                fill: false,
                tension: 0.3
            }]
        },
        options: {
            responsive: true,
            plugins: {legend: {display: true}}
        }
    });
}
</script>
</body>
</html>
