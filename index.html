<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard de Clubes</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js"></script>
    <style>
        body { font-family: Arial, sans-serif; background: #111; color: #fff; margin: 0; padding: 0; text-align: center; }
        h1 { margin: 10px 0; color: #0f0; }
        .filtros { margin: 5px 0; font-size: 14px; }
        input, select, button { padding: 4px; margin: 2px; border-radius: 4px; border: none; }
        .cards { display: flex; justify-content: space-around; flex-wrap: wrap; margin: 5px 0; }
        .card { background: #222; border-radius: 8px; padding: 10px; width: 140px; box-shadow: 0 0 8px #0f0; margin: 5px; }
        .card h2 { font-size: 14px; color: #0f0; margin-bottom: 5px; }
        .card p { font-size: 18px; font-weight: bold; color: #fff; }
        .graficos { display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; max-width: 1000px; margin: auto; }
        .grafico-container { background: #222; border-radius: 8px; padding: 5px; }
        canvas { height: 150px !important; }
        .tabelas-top10 { display: grid; grid-template-columns: repeat(3, 1fr); gap: 5px; margin: 10px auto; max-width: 1000px; }
        table { width: 100%; border-collapse: collapse; font-size: 11px; background: #222; border-radius: 4px; }
        th, td { border: 1px solid #0f0; padding: 4px; text-align: center; }
        th { background: #333; color: #0f0; font-size: 12px; }
        td { color: #fff; }
        tr:hover { background: #333; }
    </style>
</head>
<body>
    <h1>Dashboard de Clubes</h1>
    <div class="filtros">
        Data: <input type="date" id="dataFiltro">
        Clube: <select id="clubeSelect"></select>
        <button onclick="aplicarFiltros()">Aplicar</button>
    </div>

    <div class="cards">
        <div class="card"><h2>FTD</h2><p id="totalFTD">R$ 0,00</p></div>
        <div class="card"><h2>Depósitos</h2><p id="totalDepositos">R$ 0,00</p></div>
        <div class="card"><h2>GGR</h2><p id="totalGGR">R$ 0,00</p></div>
        <div class="card"><h2>Sportsbook GGR</h2><p id="totalSportsGGR">R$ 0,00</p></div>
        <div class="card"><h2>Cassino GGR</h2><p id="totalCassinoGGR">R$ 0,00</p></div>
    </div>

    <div class="graficos">
        <div class="grafico-container"><canvas id="graficoGGR"></canvas></div>
        <div class="grafico-container"><canvas id="graficoFTD"></canvas></div>
        <div class="grafico-container"><canvas id="graficoDepositos"></canvas></div>
        <div class="grafico-container"><canvas id="graficoSportsGGR"></canvas></div>
        <div class="grafico-container"><canvas id="graficoCassinoGGR"></canvas></div>
    </div>

    <h2>Top 10 Clubes</h2>
    <div class="tabelas-top10">
        <table id="rankingDepositos"></table>
        <table id="rankingFTD"></table>
        <table id="rankingGGR"></table>
    </div>

    <script>
        const csvUrl = "https://docs.google.com/spreadsheets/d/e/2PACX-1vQ21mvugq-_T80mCuddCnebiH30MWwJvQ58QiS9OqzHJuTXEVPsOFa9_Apzt4e9rlrLEeQtc8p60t80/pub?gid=0&single=true&output=csv";
        let dados = [];
        let charts = {};

        function carregarCSV() {
            Papa.parse(csvUrl, {
                download: true,
                header: true,
                complete: results => {
                    dados = results.data;
                    popularFiltroClubes();
                    atualizarDashboard();
                }
            });
        }

        function popularFiltroClubes() {
            let clubes = [...new Set(dados.map(l => l["Usuário - Nome de usuário"]))];
            let select = document.getElementById("clubeSelect");
            select.innerHTML = "<option value=''>Todos</option>";
            clubes.forEach(clube => {
                let opt = document.createElement("option");
                opt.value = clube;
                opt.innerText = clube;
                select.appendChild(opt);
            });
        }

        function aplicarFiltros() { atualizarDashboard(); }

        function atualizarDashboard() {
            let dataFiltro = document.getElementById("dataFiltro").value;
            let clubeFiltro = document.getElementById("clubeSelect").value;

            let filtrados = dados.filter(l => {
                return (!dataFiltro || l["DATA"] === dataFiltro) && (!clubeFiltro || l["Usuário - Nome de usuário"] === clubeFiltro);
            });

            let totalFTD=0, totalDep=0, totalGGR=0, totalSports=0, totalCassino=0;
            let porData = {};
            filtrados.forEach(l => {
                let d = l["DATA"];
                totalFTD += parseFloat(l["Usuário - FTD-Montante"]||0);
                totalDep += parseFloat(l["Usuário - Depósitos"]||0);
                totalGGR += parseFloat(l["Cálculo - GGR"]||0);
                totalSports += parseFloat(l["Sportsbook - GGR"]||0);
                totalCassino += parseFloat(l["Cassino - GGR"]||0);
                if (!porData[d]) porData[d] = {FTD:0, Dep:0, GGR:0, Sports:0, Cassino:0};
                porData[d].FTD += parseFloat(l["Usuário - FTD-Montante"]||0);
                porData[d].Dep += parseFloat(l["Usuário - Depósitos"]||0);
                porData[d].GGR += parseFloat(l["Cálculo - GGR"]||0);
                porData[d].Sports += parseFloat(l["Sportsbook - GGR"]||0);
                porData[d].Cassino += parseFloat(l["Cassino - GGR"]||0);
            });

            document.getElementById("totalFTD").innerText = formatarMoeda(totalFTD);
            document.getElementById("totalDepositos").innerText = formatarMoeda(totalDep);
            document.getElementById("totalGGR").innerText = formatarMoeda(totalGGR);
            document.getElementById("totalSportsGGR").innerText = formatarMoeda(totalSports);
            document.getElementById("totalCassinoGGR").innerText = formatarMoeda(totalCassino);

            montarGraficos(porData);
            montarTop10(filtrados);
        }

        function montarGraficos(porData) {
            let labels = Object.keys(porData).sort();
            let dataFTD = labels.map(d => porData[d].FTD);
            let dataDep = labels.map(d => porData[d].Dep);
            let dataGGR = labels.map(d => porData[d].GGR);
            let dataSports = labels.map(d => porData[d].Sports);
            let dataCassino = labels.map(d => porData[d].Cassino);

            criarGrafico("graficoFTD", "FTD", labels, dataFTD);
            criarGrafico("graficoDepositos", "Depósitos", labels, dataDep);
            criarGrafico("graficoGGR", "GGR", labels, dataGGR);
            criarGrafico("graficoSportsGGR", "Sportsbook GGR", labels, dataSports);
            criarGrafico("graficoCassinoGGR", "Cassino GGR", labels, dataCassino);
        }

        function criarGrafico(id, label, labels, data) {
            if (charts[id]) charts[id].destroy();
            charts[id] = new Chart(document.getElementById(id), {
                type: 'line',
                data: { labels, datasets: [{ label, data, borderColor: '#0f0', backgroundColor: '#0f02', tension: 0.3 }] },
                options: { responsive: true, plugins: { legend: { labels: { color: '#fff' } } }, scales: { x: { ticks: { color: '#fff' } }, y: { ticks: { color: '#fff' } } } }
            });
        }

        function montarTop10(filtrados) {
            let porClube = {};
            filtrados.forEach(l => {
                let c = l["Usuário - Nome de usuário"];
                if (!porClube[c]) porClube[c] = {FTD:0, Dep:0, GGR:0};
                porClube[c].FTD += parseFloat(l["Usuário - FTD-Montante"]||0);
                porClube[c].Dep += parseFloat(l["Usuário - Depósitos"]||0);
                porClube[c].GGR += parseFloat(l["Cálculo - GGR"]||0);
            });
            let topDep = Object.entries(porClube).sort((a,b)=>b[1].Dep-a[1].Dep).slice(0,10);
            let topFTD = Object.entries(porClube).sort((a,b)=>b[1].FTD-a[1].FTD).slice(0,10);
            let topGGR = Object.entries(porClube).sort((a,b)=>b[1].GGR-a[1].GGR).slice(0,10);

            renderTabela("rankingDepositos","Top 10 Depósitos",topDep,"Dep");
            renderTabela("rankingFTD","Top 10 FTD",topFTD,"FTD");
            renderTabela("rankingGGR","Top 10 GGR",topGGR,"GGR");
        }

        function renderTabela(id, titulo, dados, campo) {
            let tabela = document.getElementById(id);
            tabela.innerHTML = `<tr><th>${titulo}</th><th>Valor</th></tr>`;
            dados.forEach(([clube, valores]) => {
                tabela.innerHTML += `<tr><td>${clube}</td><td>${formatarMoeda(valores[campo])}</td></tr>`;
            });
        }

        function formatarMoeda(v) { return v.toLocaleString('pt-BR',{style:'currency',currency:'BRL'}); }
        window.onload = carregarCSV;
    </script>
</body>
</html>
