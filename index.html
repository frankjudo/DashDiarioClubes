<!DOCTYPE html>
<html lang="pt-br" data-theme="dark">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Dashboard Comparativo de Clubes</title>

  <!-- FontAwesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"/>

  <!-- jQuery, Chart.js, PapaParse -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.4/jquery.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js"></script>

  <style>
    :root {
      --primary: #2c3e50;
      --secondary: #3498db;
      --accent: #e74c3c;
      --success: #2ecc71;
      --warning: #f39c12;
      --info: #9b59b6;
      --dark: #1a252f;
      --light: #ecf0f1;
      --gray: #95a5a6;
      --dark-gray: #34495e;
    }
    [data-theme="light"] {
      --dark: #ffffff;
      --light: #2c3e50;
      --primary: #ecf0f1;
      --secondary: #2c3e50;
      --gray: #7f8c8d;
    }
    * { margin:0; padding:0; box-sizing:border-box; font-family:'Segoe UI', sans-serif; }
    body {
      background: linear-gradient(135deg, var(--dark), var(--primary));
      color: var(--light);
      padding:20px;
      transition:background .3s, color .3s;
    }
    .container { max-width:1400px; margin:0 auto; }

    header {
      text-align:center; margin-bottom:30px; padding:20px;
      background:rgba(26,37,47,0.7); border-radius:12px;
      box-shadow:0 8px 32px rgba(0,0,0,0.3); backdrop-filter:blur(10px);
      border:1px solid rgba(255,255,255,0.1);
    }
    header h1 {
      font-size:2.6rem;
      background:linear-gradient(to right, var(--secondary), var(--success));
      -webkit-background-clip:text; -webkit-text-fill-color:transparent;
      display:inline-block;
    }
    header p { color:var(--gray); margin-top:8px; }

    /* Controls */
    .controls {
      background:rgba(26,37,47,0.7); border-radius:12px; padding:20px;
      box-shadow:0 8px 32px rgba(0,0,0,0.3); backdrop-filter:blur(10px);
      border:1px solid rgba(255,255,255,0.1); margin-bottom:30px;
    }
    .controls h3 {
      color:var(--secondary); margin-bottom:12px; display:flex; align-items:center; gap:8px;
    }
    .controls label { color:var(--light); font-weight:600; min-width:70px; }
    .controls input, .controls select {
      padding:8px 12px; border:none; border-radius:6px;
      background:rgba(0,0,0,0.2); color:var(--light);
    }
    .controls button {
      padding:8px 14px; border:none; border-radius:6px;
      font-weight:600; cursor:pointer; display:flex; align-items:center; gap:6px;
      transition:background .2s;
    }
    .btn-period { background:rgba(52,152,219,0.2); color:var(--secondary); }
    .btn-apply  { background:rgba(46,204,113,0.2); color:var(--success); }
    .btn-export { background:rgba(155,89,182,0.2); color:var(--info); }
    .btn-mode   { background:rgba(243,156,18,0.2); color:var(--warning); }
    .btn-period:hover { background:rgba(52,152,219,0.3); }
    .btn-apply:hover  { background:rgba(46,204,113,0.3); }
    .btn-export:hover { background:rgba(155,89,182,0.3); }
    .btn-mode:hover   { background:rgba(243,156,18,0.3); }

    /* KPI cards */
    .kpi-container {
      display:grid; grid-template-columns:repeat(auto-fit,minmax(200px,1fr)); gap:20px;
      margin-bottom:30px;
    }
    .kpi {
      background:rgba(26,37,47,0.7); border-radius:12px; padding:20px;
      text-align:center; box-shadow:0 8px 32px rgba(0,0,0,0.3);
      border:1px solid rgba(255,255,255,0.1); transition:transform .2s;
    }
    .kpi:hover { transform:translateY(-4px); }
    .kpi i { font-size:2rem; margin-bottom:10px; }
    .kpi h3 { color:var(--gray); margin-bottom:6px; }
    .kpi .valor { font-size:1.5rem; font-weight:700; }
    .kpi .variacao { margin-top:6px; font-weight:600; }
    .positive { border-left:4px solid var(--success); }
    .negative { border-left:4px solid var(--accent); }

    /* Charts & tables */
    .charts, .tables { display:grid; gap:20px; }
    .charts { grid-template-columns:repeat(auto-fit,minmax(300px,1fr)); margin-bottom:30px; }
    .chart-container, .table-container {
      background:rgba(26,37,47,0.7); border-radius:12px; padding:16px;
      box-shadow:0 8px 32px rgba(0,0,0,0.3); border:1px solid rgba(255,255,255,0.1);
    }
    .chart-container h3, .table-container h3 {
      color:var(--secondary); margin-bottom:12px; display:flex; align-items:center; gap:6px;
    }
    .chart-container canvas { width:100% !important; height:240px !important; }

    table { width:100%; border-collapse:collapse; color:var(--light); }
    th, td { padding:8px 12px; }
    th {
      background:rgba(52,152,219,0.2); color:var(--secondary); text-align:left;
    }
    tr:hover { background:rgba(255,255,255,0.05); }

    footer {
      text-align:center; margin-top:30px; color:var(--gray);
    }

    @keyframes spin { to { transform:rotate(360deg); } }
    #loadingOverlay {
      display:none; position:fixed; top:0; left:0; right:0; bottom:0;
      background:rgba(0,0,0,0.8); z-index:9999;
      display:flex; justify-content:center; align-items:center; flex-direction:column;
    }
    .spinner {
      width:60px; height:60px;
      border:6px solid rgba(52,152,219,0.2);
      border-top-color:var(--secondary);
      border-radius:50%; animation:spin 1s linear infinite;
      margin-bottom:12px;
    }
  </style>
</head>

<body>
  <div id="loadingOverlay">
    <div class="spinner"></div>
    <div id="loadingMessage" style="color:var(--light);font-weight:600;">Carregando dados...</div>
  </div>

  <div class="container">
    <header>
      <h1><i class="fas fa-chart-line"></i> Dashboard Comparativo de Clubes</h1>
      <p>Analise e compare o desempenho de diferentes clubes em tempo real</p>
    </header>

    <section class="controls">
      <div id="demoWarning" style="display:none; margin-bottom:16px; color:var(--warning);">
        <i class="fas fa-exclamation-triangle"></i>
        Você está visualizando dados de demonstração.
      </div>

      <!-- Período -->
      <div class="control-block">
        <h3><i class="fas fa-calendar-alt"></i> Período</h3>
        <label for="filtroInicio">De:</label>
        <input type="date" id="filtroInicio" />
        <label for="filtroFim">Até:</label>
        <input type="date" id="filtroFim" />
        <button class="btn-period" onclick="setPeriodo(1)"><i class="fas fa-calendar-day"></i> Ontem</button>
        <button class="btn-period" onclick="setPeriodo(7)"><i class="fas fa-calendar-week"></i> Últimos 7 dias</button>
        <button class="btn-period" onclick="setPeriodo(30)"><i class="fas fa-calendar-alt"></i> Últimos 30 dias</button>
      </div>

      <!-- Clubes -->
      <div class="control-block" style="margin-top:16px;">
        <h3><i class="fas fa-users"></i> Clubes</h3>
        <label for="filtroClubeA">Clube A:</label>
        <select id="filtroClubeA"></select>
        <label for="filtroClubeB">Clube B:</label>
        <select id="filtroClubeB"></select>
        <button class="btn-apply" onclick="aplicarFiltros()"><i class="fas fa-filter"></i> Aplicar Filtros</button>
      </div>

      <!-- Ações -->
      <div class="control-block" style="margin-top:16px;">
        <h3><i class="fas fa-cog"></i> Ações</h3>
        <button class="btn-export" onclick="exportarCSV()"><i class="fas fa-file-csv"></i> Exportar CSV</button>
        <button class="btn-mode" onclick="toggleDarkMode()"><i class="fas fa-adjust"></i> Alternar Tema</button>
        <button class="btn-mode" onclick="atualizarDados()"><i class="fas fa-sync"></i> Atualizar Dados</button>
      </div>

      <!-- Fonte de dados -->
      <div class="control-block" style="margin-top:16px;">
        <h3><i class="fas fa-database"></i> Fonte de Dados</h3>
        <a href="https://docs.google.com/spreadsheets/d/e/2PACX-1vQ21mvugq-_T80mCuddCnebiH30MWwJvQ58QiS9OqzHJuTXEVPsOFa9_Apzt4e9rlrLEeQtc8p60t80/pub?gid=0&single=true&output=csv"
           target="_blank" rel="noopener noreferrer"
           style="color:var(--info); text-decoration:underline;">
          Documento CSV do Google Sheets
        </a>
      </div>
    </section>

    <!-- KPIs -->
    <div class="kpi-container">
      <div class="kpi positive" id="kpi-ftd">
        <i class="fa-solid fa-user-plus"></i><h3>FTD</h3>
        <div class="valor">R$ 0,00</div><div class="variacao">—</div>
      </div>
      <div class="kpi positive" id="kpi-depositos">
        <i class="fa-solid fa-coins"></i><h3>Depósitos</h3>
        <div class="valor">R$ 0,00</div><div class="variacao">—</div>
      </div>
      <div class="kpi positive" id="kpi-ggr">
        <i class="fa-solid fa-chart-line"></i><h3>GGR</h3>
        <div class="valor">R$ 0,00</div><div class="variacao">—</div>
      </div>
      <div class="kpi negative" id="kpi-sportsbook">
        <i class="fa-solid fa-futbol"></i><h3>Sportsbook GGR</h3>
        <div class="valor">R$ 0,00</div><div class="variacao">—</div>
      </div>
      <div class="kpi positive" id="kpi-cassino">
        <i class="fa-solid fa-dice"></i><h3>Cassino GGR</h3>
        <div class="valor">R$ 0,00</div><div class="variacao">—</div>
      </div>
      <div class="kpi negative" id="kpi-bonus">
        <i class="fa-solid fa-gift"></i><h3>Bônus Convertidos</h3>
        <div class="valor">R$ 0,00</div><div class="variacao">—</div>
      </div>
    </div>

    <!-- Gráficos -->
    <div class="charts">
      <div class="chart-container"><h3><i class="fas fa-chart-bar"></i> Visão Geral Comparativa</h3><canvas id="chartComparativo"></canvas></div>
      <div class="chart-container"><h3><i class="fas fa-chart-line"></i> Evolução do GGR</h3><canvas id="chartGGR"></canvas></div>
      <div class="chart-container"><h3><i class="fas fa-money-bill-wave"></i> Evolução de Depósitos</h3><canvas id="chartDepositos"></canvas></div>
      <div class="chart-container"><h3><i class="fas fa-user-plus"></i> Evolução do FTD</h3><canvas id="chartFTD"></canvas></div>
      <div class="chart-container"><h3><i class="fas fa-futbol"></i> Evolução do Sportsbook</h3><canvas id="chartSportsbook"></canvas></div>
      <div class="chart-container"><h3><i class="fas fa-dice"></i> Evolução do Cassino</h3><canvas id="chartCassino"></canvas></div>
    </div>

    <!-- Tabelas -->
    <div class="tables">
      <div class="table-container"><h3><i class="fas fa-trophy"></i> Top 10 Depósitos</h3>
        <table id="topDepositos"><thead><tr><th>Clube</th><th>Valor</th><th>Variação</th></tr></thead><tbody></tbody></table>
      </div>
      <div class="table-container"><h3><i class="fas fa-trophy"></i> Top 10 FTD</h3>
        <table id="topFTD"><thead><tr><th>Clube</th><th>Valor</th><th>Variação</th></tr></thead><tbody></tbody></table>
      </div>
      <div class="table-container"><h3><i class="fas fa-trophy"></i> Top 10 GGR</h3>
        <table id="topGGR"><thead><tr><th>Clube</th><th>Valor</th><th>Variação</th></tr></thead><tbody></tbody></table>
      </div>
    </div>

    <footer>
      <p>Última atualização: <span id="ultimaAtualizacao">—</span></p>
      <p>Dashboard desenvolvido para análise comparativa de clubes | Dados atualizados automaticamente</p>
    </footer>
  </div>

  <script>
    // Puxa variáveis CSS
    const css = getComputedStyle(document.documentElement);
    const COR_LIGHT     = css.getPropertyValue('--light').trim();
    const COR_SECONDARY = css.getPropertyValue('--secondary').trim();
    const COR_GRAY      = css.getPropertyValue('--gray').trim();

    const URL_CSV = "https://docs.google.com/spreadsheets/d/e/2PACX-1vQ21mvugq-_T80mCuddCnebiH30MWwJvQ58QiS9OqzHJuTXEVPsOFa9_Apzt4e9rlrLEeQtc8p60t80/pub?gid=0&single=true&output=csv";
    let dados = [], charts = {}, valoresAnteriores = {};

    const dadosDemo = [
      {"DATA":"2025-07-31","Usuário - Nome de username":"Clube Alpha","Usuário - FTD-Montante":"1500","Usuário - Depósitos":"4500","Cálculo - GGR":"3200","Sportsbook - GGR":"1800","Cassino - GGR":"1400","Cálculo - bônus convertidos":"500"},
      {"DATA":"2025-08-01","Usuário - Nome de username":"Clube Alpha","Usuário - FTD-Montante":"1200","Usuário - Depósitos":"3800","Cálculo - GGR":"2800","Sportsbook - GGR":"1500","Cassino - GGR":"1300","Cálculo - bônus convertidos":"450"},
      {"DATA":"2025-08-02","Usuário - Nome de username":"Clube Alpha","Usuário - FTD-Montante":"1800","Usuário - Depósitos":"5200","Cálculo - GGR":"3800","Sportsbook - GGR":"2200","Cassino - GGR":"1600","Cálculo - bônus convertidos":"600"},
      {"DATA":"2025-07-31","Usuário - Nome de username":"Clube Beta","Usuário - FTD-Montante":"2200","Usuário - Depósitos":"6800","Cálculo - GGR":"4800","Sportsbook - GGR":"2800","Cassino - GGR":"2000","Cálculo - bônus convertidos":"800"},
      {"DATA":"2025-08-01","Usuário - Nome de username":"Clube Beta","Usuário - FTD-Montante":"1900","Usuário - Depósitos":"6100","Cálculo - GGR":"4200","Sportsbook - GGR":"2400","Cassino - GGR":"1800","Cálculo - bônus convertidos":"750"},
      {"DATA":"2025-08-02","Usuário - Nome de username":"Clube Beta","Usuário - FTD-Montante":"2500","Usuário - Depósitos":"7500","Cálculo - GGR":"5500","Sportsbook - GGR":"3200","Cassino - GGR":"2300","Cálculo - bônus convertidos":"900"},
      {"DATA":"2025-07-31","Usuário - Nome de username":"Clube Gamma","Usuário - FTD-Montante":"800","Usuário - Depósitos":"2500","Cálculo - GGR":"1800","Sportsbook - GGR":"1000","Cassino - GGR":"800","Cálculo - bônus convertidos":"300"},
      {"DATA":"2025-08-01","Usuário - Nome de username":"Clube Gamma","Usuário - FTD-Montante":"950","Usuário - Depósitos":"2900","Cálculo - GGR":"2100","Sportsbook - GGR":"1200","Cassino - GGR":"900","Cálculo - bônus convertidos":"350"},
      {"DATA":"2025-08-02","Usuário - Nome de username":"Clube Gamma","Usuário - FTD-Montante":"1100","Usuário - Depósitos":"3300","Cálculo - GGR":"2400","Sportsbook - GGR":"1400","Cassino - GGR":"1000","Cálculo - bônus convertidos":"400"},
      {"DATA":"2025-07-31","Usuário - Nome de username":"Clube Delta","Usuário - FTD-Montante":"3000","Usuário - Depósitos":"9000","Cálculo - GGR":"6500","Sportsbook - GGR":"3800","Cassino - GGR":"2700","Cálculo - bônus convertidos":"1200"},
      {"DATA":"2025-08-01","Usuário - Nome de username":"Clube Delta","Usuário - FTD-Montante":"2700","Usuário - Depósitos":"8200","Cálculo - GGR":"5900","Sportsbook - GGR":"3500","Cassino - GGR":"2400","Cálculo - bônus convertidos":"1100"},
      {"DATA":"2025-08-02","Usuário - Nome de username":"Clube Delta","Usuário - FTD-Montante":"3300","Usuário - Depósitos":"9800","Cálculo - GGR":"7100","Sportsbook - GGR":"4200","Cassino - GGR":"2900","Cálculo - bônus convertidos":"1300"}
    ];

    function showLoading(on, msg="Carregando dados...") {
      $("#loadingMessage").text(msg);
      $("#loadingOverlay").css("display", on ? "flex" : "none");
    }

    function criarGrafico(ctx, labelA, labelB, colorA, colorB, type='line') {
      return new Chart(ctx, {
        type,
        data: {
          labels: [],
          datasets: [
            {
              label: labelA, data: [],
              borderColor: colorA,
              backgroundColor: type==='bar'?colorA+'55':'transparent',
              fill: type==='line', tension:0.3, borderWidth:3, pointRadius:4, pointBackgroundColor:colorA
            },
            {
              label: labelB, data: [],
              borderColor: colorB,
              backgroundColor: type==='bar'?colorB+'55':'transparent',
              fill: type==='line', tension:0.3, borderWidth:3, pointRadius:4, pointBackgroundColor:colorB
            }
          ]
        },
        options: {
          responsive:true, maintainAspectRatio:false,
          plugins:{
            legend:{
              position:'top',
              labels:{ color:COR_LIGHT, font:{size:12} }
            },
            tooltip:{
              backgroundColor:'rgba(26,37,47,0.9)',
              titleColor:COR_SECONDARY,
              bodyColor:COR_LIGHT,
              displayColors:false,
              padding:8,
              callbacks:{ label:ctx=>`${ctx.dataset.label}: R$ ${ctx.parsed.y.toLocaleString('pt-BR',{minimumFractionDigits:2})}` }
            }
          },
          scales:{
            y:{ beginAtZero:true, ticks:{ color:COR_GRAY, callback:v=>`R$ ${v.toLocaleString('pt-BR')}` }, grid:{color:'rgba(255,255,255,0.05)'} },
            x:{ ticks:{color:COR_GRAY}, grid:{color:'rgba(255,255,255,0.05)'} }
          }
        }
      });
    }

    function animarKPI(sel, novo, anterior) {
      let $el = $(sel+' .valor'), $var = $(sel+' .variacao');
      let diffpct = anterior?((novo-anterior)/anterior)*100:0;
      let sinal = diffpct>=0?'↑':'↓', cor = diffpct>=0?css.getPropertyValue('--success'):css.getPropertyValue('--accent');
      $var.html(`<span style="color:${cor}">${sinal}${Math.abs(diffpct).toFixed(1)}%</span>`);
      $(sel).removeClass('positive negative').addClass(novo>=0?'positive':'negative');
      let atual = parseFloat($el.text().replace(/[^\d]/g,''))||0;
      let step = (novo-atual)/30, cnt=0, cur=atual;
      let iv = setInterval(()=>{
        cur+=step; cnt++;
        if(cnt>=30){ clearInterval(iv); cur=novo; }
        $el.text('R$ '+cur.toLocaleString('pt-BR',{minimumFractionDigits:2}));
      },20);
      valoresAnteriores[sel]=novo;
    }

    function carregar() {
      showLoading(true,'Conectando à fonte de dados...');
      Papa.parse(URL_CSV,{ download:true, header:true,
        complete:r=>{
          if(r.data[0] && r.data[0].DATA) {
            dados = r.data.filter(d=>d.DATA); $('#demoWarning').hide();
          } else {
            dados = dadosDemo; $('#demoWarning').show();
          }
          init();
        },
        error:_=>{
          dados = dadosDemo; $('#demoWarning').show(); init();
        }
      });
    }

    function init() {
      // popula selects
      const clubes = [...new Set(dados.map(d=>d['Usuário - Nome de username']||d['Usuário - Nome de usuário']))];
      const opts = '<option value="Todos">Todos os Clubes</option>' + clubes.map(c=>`<option value="${c}">${c}</option>`).join('');
      $('#filtroClubeA,#filtroClubeB').html(opts).val('Todos');

      // datas
      const hoje=new Date(), ini=new Date(); ini.setDate(hoje.getDate()-7);
      $('#filtroInicio').val(ini.toISOString().slice(0,10));
      $('#filtroFim').val(hoje.toISOString().slice(0,10));

      // criar gráficos
      charts.chartComparativo = criarGrafico($('#chartComparativo')[0],'A','B','#3498db','#e74c3c','bar');
      charts.chartGGR        = criarGrafico($('#chartGGR')[0],'A','B','#3498db','#e74c3c');
      charts.chartDepositos  = criarGrafico($('#chartDepositos')[0],'A','B','#3498db','#e74c3c');
      charts.chartFTD        = criarGrafico($('#chartFTD')[0],'A','B','#3498db','#e74c3c');
      charts.chartSportsbook = criarGrafico($('#chartSportsbook')[0],'A','B','#3498db','#e74c3c');
      charts.chartCassino    = criarGrafico($('#chartCassino')[0],'A','B','#3498db','#e74c3c');

      // ini KPIs
      ['#kpi-ftd','#kpi-depositos','#kpi-ggr','#kpi-sportsbook','#kpi-cassino','#kpi-bonus']
        .forEach(sel=>valoresAnteriores[sel]=0);

      atualizar();
      showLoading(false);
      setInterval(atualizarDados,300000);
    }

    function aplicarFiltros(){ atualizar(); }
    function setPeriodo(d){
      const hoje=new Date(), ini=new Date(); ini.setDate(hoje.getDate()-d);
      $('#filtroInicio').val(ini.toISOString().slice(0,10));
      $('#filtroFim').val(hoje.toISOString().slice(0,10));
      atualizar();
    }
    function atualizarDados(){ showLoading(true,'Atualizando dados...'); carregar(); }

    function atualizar(){
      const ini=$('#filtroInicio').val(), fim=$('#filtroFim').val();
      const ca=$('#filtroClubeA').val(), cb=$('#filtroClubeB').val();
      const base=dados.filter(d=>(!ini||d.DATA>=ini)&&(!fim||d.DATA<=fim));
      const filtra=c=>c==='Todos'?base:base.filter(d=>(d['Usuário - Nome de username']||d['Usuário - Nome de usuário'])===c);
      const A=filtra(ca), B=filtra(cb);
      const soma=(arr,f)=>>arr.reduce((s,d)=>s+(parseFloat(d[f])||0),0);

      animarKPI('#kpi-ftd', soma(A,'Usuário - FTD-Montante')+soma(B,'Usuário - FTD-Montante'), valoresAnteriores['#kpi-ftd']);
      animarKPI('#kpi-depositos', soma(A,'Usuário - Depósitos')+soma(B,'Usuário - Depósitos'), valoresAnteriores['#kpi-depositos']);
      animarKPI('#kpi-ggr', soma(A,'Cálculo - GGR')+soma(B,'Cálculo - GGR'), valoresAnteriores['#kpi-ggr']);
      animarKPI('#kpi-sportsbook', soma(A,'Sportsbook - GGR')+soma(B,'Sportsbook - GGR'), valoresAnteriores['#kpi-sportsbook']);
      animarKPI('#kpi-cassino', soma(A,'Cassino - GGR')+soma(B,'Cassino - GGR'), valoresAnteriores['#kpi-cassino']);
      animarKPI('#kpi-bonus', soma(A,'Cálculo - bônus convertidos')+soma(B,'Cálculo - bônus convertidos'), valoresAnteriores['#kpi-bonus']);

      // agrupa por data
      const agrupa=arr=>{
        const o={};
        arr.forEach(d=>{
          o[d.DATA]=o[d.DATA]||{g:0,dep:0,ftd:0,sb:0,cs:0,bo:0};
          o[d.DATA].g+=parseFloat(d['Cálculo - GGR'])||0;
          o[d.DATA].dep+=parseFloat(d['Usuário - Depósitos'])||0;
          o[d.DATA].ftd+=parseFloat(d['Usuário - FTD-Montante'])||0;
          o[d.DATA].sb+=parseFloat(d['Sportsbook - GGR'])||0;
          o[d.DATA].cs+=parseFloat(d['Cassino - GGR'])||0;
          o[d.DATA].bo+=parseFloat(d['Cálculo - bônus convertidos'])||0;
        });
        return o;
      };

      const dA=agrupa(A), dB=agrupa(B);
      const labels=Object.keys({...dA,...dB}).sort();

      // atualiza linhas
      ['g','dep','ftd','sb','cs','bo'].forEach((f,i)=>{
        const ch=[charts.chartGGR,charts.chartDepositos,charts.chartFTD,charts.chartSportsbook,charts.chartCassino][i];
        ch.data.labels=labels;
        ch.data.datasets[0].data=labels.map(d=>dA[d]?.[f]||0);
        ch.data.datasets[1].data=labels.map(d=>dB[d]?.[f]||0);
        ch.update();
      });

      // comparativo
      charts.chartComparativo.data.labels=['FTD','Depósitos','GGR','Sportsbook','Cassino','Bônus'];
      charts.chartComparativo.data.datasets[0].data=[
        soma(A,'Usuário - FTD-Montante'),
        soma(A,'Usuário - Depósitos'),
        soma(A,'Cálculo - GGR'),
        soma(A,'Sportsbook - GGR'),
        soma(A,'Cassino - GGR'),
        soma(A,'Cálculo - bônus convertidos')
      ];
      charts.chartComparativo.data.datasets[1].data=[
        soma(B,'Usuário - FTD-Montante'),
        soma(B,'Usuário - Depósitos'),
        soma(B,'Cálculo - GGR'),
        soma(B,'Sportsbook - GGR'),
        soma(B,'Cassino - GGR'),
        soma(B,'Cálculo - bônus convertidos')
      ];
      charts.chartComparativo.update();

      $('#ultimaAtualizacao').text(new Date().toLocaleString('pt-BR'));
    }

    function exportarCSV(){
      const csv=Papa.unparse(dados), blob=new Blob(['\uFEFF'+csv],{type:'text/csv'}), a=document.createElement('a');
      a.href=URL.createObjectURL(blob);
      a.download='dados_clubes.csv';
      a.click();
    }

    function toggleDarkMode(){
      const html=document.documentElement;
      html.setAttribute('data-theme',html.getAttribute('data-theme')==='dark'?'light':'dark');
    }

    $(document).ready(()=>{
      carregar();
      $('.kpi, button').hover(
        function(){ $(this).css('transform','translateY(-2px)') },
        function(){ $(this).css('transform','none') }
      );
    });
  </script>
</body>
</html>
