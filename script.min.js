console.log("Rodando versão minificada com filtros e gráficos otimizados");
const urlCSV="https://docs.google.com/spreadsheets/d/e/2PACX-1vQ21mvugq-_T80mCuddCnebiH30MWwJvQ58QiS9OqzHJuTXEVPsOFa9_Apzt4e9rlrLEeQtc8p60t80/pub?gid=0&single=true&output=csv";
let chartGGR,chartFTD,chartDepositos;
document.addEventListener("DOMContentLoaded",()=>{carregarDados();document.getElementById("btnAplicar").addEventListener("click",aplicarFiltros);});
function carregarDados(){console.log("Iniciando carregamento do CSV...");Papa.parse(urlCSV,{download:!0,header:!0,complete:function(r){const dados=r.data.filter(e=>e.DATA);console.log("Linhas recebidas:",dados.length);console.log("Primeira linha:",dados[0]);atualizarDashboard(dados);}})}
function aplicarFiltros(){const dt=document.getElementById("dataFiltro").value,clube=document.getElementById("clubeFiltro").value;carregarDados(dt,clube);}
function atualizarDashboard(dados){const ftdTotal=dados.reduce((s,e)=>s+(parseFloat(e["Usuário - FTD-Montante"])||0),0),depTotal=dados.reduce((s,e)=>s+(parseFloat(e["Usuário - Depósitos"])||0),0),ggrTotal=dados.reduce((s,e)=>s+(parseFloat(e["GGR"])||0),0);document.getElementById("valorFTD").textContent="R$ "+ftdTotal.toLocaleString("pt-BR");document.getElementById("valorDepositos").textContent="R$ "+depTotal.toLocaleString("pt-BR");document.getElementById("valorGGR").textContent="R$ "+ggrTotal.toLocaleString("pt-BR");console.log(`Totais calculados -> FTD: ${ftdTotal}, Depósitos: ${depTotal}, GGR: ${ggrTotal}`);atualizarGraficos(dados);}
function atualizarGraficos(dados){const datas=[...new Set(dados.map(e=>e.DATA))];const somaPorData=(campo)=>datas.map(d=>dados.filter(x=>x.DATA==d).reduce((s,v)=>s+(parseFloat(v[campo])||0),0));const ggr=somaPorData("GGR"),ftd=somaPorData("Usuário - FTD-Montante"),dep=somaPorData("Usuário - Depósitos");const maxVal=Math.max(...ggr,...ftd,...dep)*1.2;chartGGR&&chartGGR.destroy();chartFTD&&chartFTD.destroy();chartDepositos&&chartDepositos.destroy();const config=(ctx,label,data,color)=>new Chart(ctx,{type:"line",data:{labels:datas,datasets:[{label:label,data:data,borderColor:color,fill:!1,tension:.2}]},options:{responsive:!0,scales:{y:{min:0,max:maxVal}}}});chartGGR=config(document.getElementById("graficoGGR"),"GGR Diário",ggr,"#00ff00");chartFTD=config(document.getElementById("graficoFTD"),"FTD Diário",ftd,"#ffff00");chartDepositos=config(document.getElementById("graficoDepositos"),"Depósitos Diários",dep,"#0066ff");}
