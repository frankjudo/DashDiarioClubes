console.log("Rodando versão minificada corrigida");
function consolidarPorClube(n){const t={};return n.forEach((n=>{const e=n.clube;t[e]||(t[e]={ftd:0,depositos:0,ggr:0}),t[e].ftd+=n.ftd,t[e].depositos+=n.depositos,t[e].ggr+=n.ggr})),Object.entries(t).map((([n,t])=>({clube:n,...t})))}
fetch("https://docs.google.com/spreadsheets/d/e/2PACX-1vQ21mvugq-_T80mCuddCnebiH30MWwJvQ58QiS9OqzHJuTXEVPsOFa9_Apzt4e9rlrLEeQtc8p60t80/pub?gid=0&single=true&output=csv")
.then(n=>n.text()).then(n=>{console.log("Iniciando carregamento do CSV...");const t=n.trim().split("\n").map(n=>n.split(","));console.log("Linhas recebidas:",t.length);
console.log("Primeira linha recebida:",t[0]);const e=t.slice(1).map((n=>({data:n[0],clube:n[2],ftd:+n[5],depositos:+n[6],ggr:+n[27]})));
console.log("Primeiras 5 linhas normalizadas:",e.slice(0,5));
const o=consolidarPorClube(e);
let r=o.reduce(((n,t)=>(n.ftd+=t.ftd,n.depositos+=t.depositos,n.ggr+=t.ggr,n)),{ftd:0,depositos:0,ggr:0});
console.log(`Totais calculados -> FTD: ${r.ftd}, Depósitos: ${r.depositos}, GGR: ${r.ggr}`);
document.getElementById("ftd").textContent=`R$ ${r.ftd.toLocaleString()}`,
document.getElementById("depositos").textContent=`R$ ${r.depositos.toLocaleString()}`,
document.getElementById("ggr").textContent=`R$ ${r.ggr.toLocaleString()}`;
o.sort(((n,t)=>t.depositos-n.depositos));
let c=o.slice(0,10).map((n=>`<tr><td>${n.clube}</td><td>R$ ${n.depositos.toLocaleString()}</td></tr>`)).join("");
document.getElementById("topDepositos").innerHTML=c,
o.sort(((n,t)=>t.ftd-n.ftd));
let a=o.slice(0,10).map((n=>`<tr><td>${n.clube}</td><td>R$ ${n.ftd.toLocaleString()}</td></tr>`)).join("");
document.getElementById("topFTD").innerHTML=a,
o.sort(((n,t)=>t.ggr-n.ggr));
let l=o.slice(0,10).map((n=>`<tr><td>${n.clube}</td><td>R$ ${n.ggr.toLocaleString()}</td></tr>`)).join("");
document.getElementById("topGGR").innerHTML=l;
new Chart(document.getElementById("graficoGGR"),{type:"line",data:{labels:e.map(n=>n.data),datasets:[{label:"GGR Diário",borderColor:"green",data:e.map(n=>n.ggr)}]}}),
new Chart(document.getElementById("graficoFTD"),{type:"line",data:{labels:e.map(n=>n.data),datasets:[{label:"FTD Diário",borderColor:"yellow",data:e.map(n=>n.ftd)}]}}),
new Chart(document.getElementById("graficoDepositos"),{type:"line",data:{labels:e.map(n=>n.data),datasets:[{label:"Depósitos Diários",borderColor:"blue",data:e.map(n=>n.depositos)}]}}),
document.getElementById("lastUpdate").textContent="Última atualização: "+new Date().toLocaleString()})
.catch(n=>console.error("Erro:",n));
