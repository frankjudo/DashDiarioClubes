console.log("Rodando versão minificada corrigida");
const URL_CSV="https://docs.google.com/spreadsheets/d/e/2PACX-1vQ21mvugq-_T80mCuddCnebiH30MWwJvQ58QiS9OqzHJuTXEVPsOFa9_Apzt4e9rlrLEeQtc8p60t80/pub?gid=0&single=true&output=csv";
let dados=[];function normalizarDados(linhas){return linhas.map(l=>({data:l[0],clube:l[2],ftd:parseFloat(l[5])||0,depositos:parseFloat(l[6])||0,ggr:parseFloat(l[26])||0}))}
function atualizarDashboard(){console.time("processamento");const t0=performance.now();let tFTD=0,tDep=0,tGGR=0;dados.forEach(l=>{tFTD+=l.ftd;tDep+=l.depositos;tGGR+=l.ggr});
document.getElementById("totalFTD").textContent=`R$ ${tFTD.toLocaleString()}`;
document.getElementById("totalDepositos").textContent=`R$ ${tDep.toLocaleString()}`;
document.getElementById("totalGGR").textContent=`R$ ${tGGR.toLocaleString()}`;
document.getElementById("ultimaAtualizacao").textContent=new Date().toLocaleString();
document.getElementById("tempoProcessamento").textContent=(performance.now()-t0).toFixed(2);
console.log(`Totais calculados -> FTD: ${tFTD}, Depósitos: ${tDep}, GGR: ${tGGR}`);
console.timeEnd("processamento")}
function carregarCSV(){console.log("Iniciando carregamento do CSV...");Papa.parse(URL_CSV,{download:true,complete:function(res){console.log(`Linhas recebidas: ${res.data.length}`);console.log("Primeira linha recebida:",res.data[0]);dados=normalizarDados(res.data.slice(1));console.log("Primeiras 5 linhas normalizadas:",dados.slice(0,5));atualizarDashboard()}})}
document.getElementById("btnAplicar").addEventListener("click",()=>atualizarDashboard());
carregarCSV();
